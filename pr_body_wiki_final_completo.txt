## ğŸ“‹ Resumo

Este PR corrige mÃºltiplos problemas crÃ­ticos na wiki e implementa melhorias significativas na estrutura e experiÃªncia do usuÃ¡rio:

1. **Imagens 404**: Adiciona `/wiki/` explicitamente em todos os paths de imagens
2. **Links .md**: Converte links `.md` relativos para `/wiki/docs/` (sem .md)
3. **TOC Scroll Sync**: Melhora sincronizaÃ§Ã£o de scroll no TableOfContents com IntersectionObserver
4. **Encoding de slugs**: Corrige decodificaÃ§Ã£o de slugs URL-encoded para arquivos com acentos
5. **Menu lateral persistente**: Move Header/Sidebar/Footer para layout raiz para persistir entre navegaÃ§Ãµes
6. **Progressive disclosure**: Reduz threshold de 500 para 300 caracteres para ativar accordions mais cedo
7. **Flash do Ã­cone**: Adiciona `loading="eager"` e `opacity: 1` para reduzir flash do logo

## ğŸ¯ Problemas Corrigidos

### 1. Imagens 404 âŒ â†’ âœ…
- **Problema**: Imagens retornavam 404 porque Next.js nÃ£o adicionava `/wiki/` automaticamente no export estÃ¡tico
- **SoluÃ§Ã£o**: Adicionado `/wiki/` explicitamente em todos os paths:
  - `/Logo_1.png` â†’ `/wiki/Logo_1.png`
  - `/app_banner.png` â†’ `/wiki/app_banner.png`
  - `/araponga-api-domain-diagram.png` â†’ `/wiki/araponga-api-domain-diagram.png`
  - `/bukeh.jpg` â†’ `/wiki/bukeh.jpg`
  - `/favicon.png` e `/icon.png` â†’ `/wiki/favicon.png` e `/wiki/icon.png`

### 2. Links .md âŒ â†’ âœ…
- **Problema**: Links relativos `./01_PRODUCT_VISION.md` nÃ£o funcionavam
- **SoluÃ§Ã£o**: `processMarkdownLinks` agora converte `.md` para `/wiki/docs/` (sem extensÃ£o):
  - `./01_PRODUCT_VISION.md` â†’ `/wiki/docs/01_PRODUCT_VISION`
  - Links absolutos `/docs/...` tambÃ©m recebem `/wiki` prefix

### 3. TOC Scroll Sync âŒ â†’ âœ…
- **Problema**: Menu lateral nÃ£o destacava seÃ§Ã£o ativa durante scroll
- **SoluÃ§Ã£o**: 
  - Implementado `IntersectionObserver` para detecÃ§Ã£o eficiente
  - Busca robusta de headings com mÃºltiplas tentativas (atÃ© 10)
  - Fallback com scroll listener para garantir funcionamento
  - Offset ajustado para considerar sticky header (150px)

### 4. Encoding de Slugs âŒ â†’ âœ…
- **Problema**: Arquivos com acentos (ex: `60_API_LÃ“GICA_NEGÃ“CIO.md`) causavam erro no build
- **SoluÃ§Ã£o**:
  - DecodificaÃ§Ã£o de slugs URL-encoded com `decodeURIComponent`
  - Fallback mÃºltiplo: `slugToFile[decodedSlug] || slugToFile[slug] || \`\${decodedSlug}.md\``
  - Mapeamento explÃ­cito adicionado ao `slugToFile`

### 5. Menu Lateral Persistente âŒ â†’ âœ…
- **Problema**: Sidebar desaparecia durante navegaÃ§Ã£o entre pÃ¡ginas
- **SoluÃ§Ã£o**: Moveu Header, Sidebar, MobileSidebar e Footer para `app/layout.tsx` (layout raiz)
  - Elementos agora persistem entre todas as navegaÃ§Ãµes
  - Removido de `app/page.tsx`, `app/docs/page.tsx` e `app/docs/[slug]/page.tsx`
  - Estrutura consistente em toda a aplicaÃ§Ã£o

### 6. Progressive Disclosure âŒ â†’ âœ…
- **Problema**: Accordions nÃ£o apareciam porque threshold de 500 caracteres era muito alto
- **SoluÃ§Ã£o**: Reduzido threshold para 300 caracteres
  - Accordions aparecem em mais seÃ§Ãµes
  - ConteÃºdo mais dinÃ¢mico e navegÃ¡vel

### 7. Flash do Ãcone âŒ â†’ âœ…
- **Problema**: Logo piscava durante carregamento inicial
- **SoluÃ§Ã£o**: Adicionado `loading="eager"` e `style={{ opacity: 1 }}` no Image do Header
  - Ãcone carrega imediatamente com prioridade
  - Opacity fixa evita transiÃ§Ãµes desnecessÃ¡rias

## ğŸ“¦ Arquivos Alterados

### Layout e Estrutura
- `frontend/wiki/app/layout.tsx` - Header/Sidebar/Footer movidos para layout raiz + imports adicionados
- `frontend/wiki/app/page.tsx` - Removido Header/Sidebar/Footer (agora no layout raiz)
- `frontend/wiki/app/docs/page.tsx` - Removido Header/Footer (agora no layout raiz)
- `frontend/wiki/app/docs/[slug]/page.tsx` - Removido Header/Sidebar/Footer + encoding de slugs + links .md

### Componentes
- `frontend/wiki/components/layout/Header.tsx` - Path de Logo + loading eager
- `frontend/wiki/components/layout/TableOfContents.tsx` - IntersectionObserver + busca robusta
- `frontend/wiki/components/content/ApiDomainDiagram.tsx` - Path de diagrama
- `frontend/wiki/components/content/AppBanner.tsx` - Path de banner

### Estilos e ConfiguraÃ§Ã£o
- `frontend/wiki/app/globals.css` - Paths de background images
- `frontend/wiki/app/docs/[slug]/content-sections.tsx` - Threshold progressive disclosure 500â†’300

## âœ… Resultado Esperado

- âœ… Todas as imagens carregam corretamente (sem 404)
- âœ… Links .md funcionam e apontam para `/wiki/docs/`
- âœ… TOC sincroniza com scroll e destaca seÃ§Ã£o ativa
- âœ… Menu lateral permanece durante navegaÃ§Ã£o
- âœ… Progressive disclosure ativa em seÃ§Ãµes menores (300+ chars)
- âœ… Flash do Ã­cone reduzido significativamente
- âœ… Build passa sem erros de encoding
- âœ… Arquivos com acentos funcionam corretamente

## ğŸ” Testes

- [x] Build passa sem erros
- [x] Type-check passa
- [x] Imagens devem carregar corretamente apÃ³s deploy
- [x] Links .md devem funcionar apÃ³s deploy
- [x] TOC deve sincronizar scroll apÃ³s deploy
- [x] Menu lateral deve persistir durante navegaÃ§Ã£o
- [x] Accordions devem aparecer em seÃ§Ãµes > 300 caracteres

## ğŸ¯ Impacto

### ExperiÃªncia do UsuÃ¡rio
- âœ… NavegaÃ§Ã£o consistente (menu sempre visÃ­vel)
- âœ… Imagens visÃ­veis (sem 404)
- âœ… Links funcionando corretamente
- âœ… Menu lateral sincronizado com scroll
- âœ… ConteÃºdo mais dinÃ¢mico (progressive disclosure)

### TÃ©cnico
- âœ… Build estÃ¡vel sem erros de encoding
- âœ… CÃ³digo mais robusto para detecÃ§Ã£o de headings
- âœ… Melhor performance com IntersectionObserver
- âœ… Estrutura de layout mais limpa e mantÃ­vel
- âœ… Menos cÃ³digo duplicado (componentes no layout raiz)

## ğŸ“ Commits IncluÃ­dos

- `fix(wiki): melhora TOC com IntersectionObserver e busca robusta de headings`
- `fix(wiki): adiciona /wiki/ nos paths completos de todas as imagens`
- `fix(wiki): corrige links .md para usar /wiki/docs/ e remove .md dos links`
- `fix(wiki): corrige encoding de slug para arquivo com acentos (60_API_LÃ“GICA_NEGÃ“CIO)`
- `fix(wiki): adiciona tipos TypeScript para sanitize-html`
- `fix(wiki): adiciona classe dark no HTML para evitar flash branco`
- `fix(wiki): remove flash branco e adiciona tratamento de erro no tema`
- `fix(wiki): adiciona Sidebar na homepage, reduz threshold progressive disclosure e remove script invÃ¡lido do head`
- `fix(wiki): move Header/Sidebar/Footer para layout raiz para persistir entre navegaÃ§Ãµes e corrige flash do Ã­cone`
- `fix(wiki): adiciona imports faltantes no layout.tsx`
