<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Developer Portal da API Araponga: territ√≥rio, memberships, feed, mapa, marketplace, eventos, chat, modera√ß√£o e notifica√ß√µes." />
  <meta name="theme-color" content="#0a0e12" />
  <title>Araponga API ‚Ä¢ Developer Portal</title>
  <link rel="icon" href="./assets/images/araponga-icon.svg" />
  <link rel="apple-touch-icon" href="./assets/images/araponga-icon.svg" />
  <link rel="stylesheet" href="./assets/css/devportal.css" />
</head>
<body>
  <a class="skip-link" href="#conteudo" data-i18n="ui.skip">Pular para conte√∫do</a>

  <header class="header" role="banner">
    <div class="container hero">
      <div class="return-banner" role="complementary">
        <span data-i18n="ui.portalTitle">Developer Portal da API Araponga</span>
        <div class="lang-switcher" aria-label="Selecionar idioma">
          <label class="lang-label" for="lang-select" data-i18n="ui.lang">Idioma</label>
          <select id="lang-select" class="lang-select">
            <option value="pt">Portugu√™s</option>
            <option value="es">Espa√±ol</option>
            <option value="en">English</option>
            <option value="it">Italiano</option>
            <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
          </select>
        </div>
        <a href="https://araponga.app" rel="noopener" aria-label="Voltar para o site principal do Araponga" data-i18n="ui.backHome">‚Üê Voltar para araponga.app</a>
      </div>

      <span class="hero-tag" aria-label="Categoria" data-i18n="ui.heroTag">Araponga API ‚Ä¢ Developer Portal</span>
      <h1 data-i18n="ui.heroTitle">Infraestrutura territorial para comunidades locais.</h1>
      <p data-i18n-html="ui.heroLeadHtml">
        O Araponga √© uma plataforma comunit√°ria <strong>territory-first</strong>. O territ√≥rio organiza contexto,
        visibilidade e governan√ßa. Este portal documenta o produto e a API exatamente como implementada hoje,
        para acelerar o onboarding de desenvolvedores com seguran√ßa e previsibilidade.
      </p>

      <nav class="hero-actions" aria-label="A√ß√µes r√°pidas">
        <a class="button" href="#quickstart" aria-label="Ir para o guia de in√≠cio r√°pido" data-i18n="ui.quickstart">Quickstart</a>
        <a class="button secondary" href="#openapi" aria-label="Ver documenta√ß√£o OpenAPI" data-i18n="ui.openapi">OpenAPI</a>
        <a class="button secondary" href="#auth" aria-label="Ver documenta√ß√£o de autentica√ß√£o" data-i18n="ui.auth">Autentica√ß√£o</a>
        <a class="button secondary" href="#territory-session" aria-label="Ver como selecionar territ√≥rio" data-i18n="ui.selectTerritory">Selecionar territ√≥rio</a>
      </nav>
    </div>
  </header>

  <div class="container layout" id="conteudo">
    <nav class="nav" aria-label="Navega√ß√£o do portal" role="navigation">
      <h2 data-i18n="nav.title">Conte√∫do</h2>
      <ul role="list">
        <li><a href="#visao-geral" data-i18n="nav.overview">Vis√£o geral</a></li>
        <li><a href="#como-funciona" data-i18n="nav.howItWorks">Como o Araponga funciona</a></li>
        <li><a href="#territorios" data-i18n="nav.territories">Territ√≥rios</a></li>
        <li><a href="#conceitos" data-i18n="nav.productConcepts">Conceitos de produto</a></li>
        <li><a href="#modelo-dominio" data-i18n="nav.domainModel">Modelo de dom√≠nio</a></li>
        <li><a href="#fluxos" data-i18n="nav.flows">Fluxos principais</a></li>
        <li><a href="#casos-de-uso" data-i18n="nav.useCases">Casos de uso</a></li>
        <li><a href="#marketplace" data-i18n="nav.marketplace">Marketplace</a></li>
        <li><a href="#payout-gestao-financeira">Payout & Gest√£o Financeira</a></li>
        <li><a href="#eventos" data-i18n="nav.events">Eventos</a></li>
        <li><a href="#auth" data-i18n="nav.jwt">Autentica√ß√£o (JWT)</a></li>
        <li><a href="#territory-session" data-i18n="nav.headers">Territ√≥rio & headers</a></li>
        <li><a href="#admin" data-i18n="nav.admin">Admin & filas</a></li>
        <li><a href="#openapi" data-i18n="nav.openapi">OpenAPI / Explorer</a></li>
        <li><a href="#erros" data-i18n="nav.errors">Erros & conven√ß√µes</a></li>
        <li><a href="#quickstart" data-i18n="nav.quickstart">Quickstart</a></li>
        <li><a href="#capacidades-tecnicas">Capacidades T√©cnicas</a></li>
        <li><a href="#versoes" data-i18n="nav.versions">Vers√µes</a></li>
      </ul>
    </nav>

    <main role="main">
      <section class="section" id="visao-geral">
        <span class="eyebrow" data-i18n="overview.eyebrow">Vis√£o geral</span>
        <h2 data-i18n="overview.title">API orientada a territ√≥rio + curadoria comunit√°ria.</h2>
        <p data-i18n="overview.lead">
          A API da Araponga cria um n√∫cleo confi√°vel para territ√≥rio, v√≠nculos, feed, mapa, marketplace e eventos. Ela prioriza
          regras expl√≠citas (visibilidade, valida√ß√£o e modera√ß√£o) para que experi√™ncias locais sejam
          audit√°veis e evoluam com seguran√ßa.
        </p>
        <div class="grid-two">
          <div class="card">
            <h3>Por que territ√≥rio?</h3>
            <p>
              Territ√≥rio √© o recorte geogr√°fico base. Ele separa o "onde" do "quem" e do "o qu√™".
              Isso evita que conte√∫do social distor√ßa o mapa e mant√©m o contexto local como primeira-class.
            </p>
          </div>
          <div class="card">
            <h3>Governan√ßa em camadas</h3>
            <p>
              V√≠nculos (visitor/resident), valida√ß√µes comunit√°rias, modera√ß√£o (reports/bloqueios) e
              notifica√ß√µes in-app
              formam as camadas que definem o que aparece no feed e no mapa.
            </p>
          </div>
        </div>
      </section>

      <section class="section" id="como-funciona">
        <span class="eyebrow" data-i18n="how.eyebrow">Como o Araponga funciona</span>
        <h2 data-i18n="how.title">Do visitante ao morador validado</h2>
        <div class="grid-two">
          <div class="card">
            <h3>Visitante</h3>
            <p>
              Visitantes declaram v√≠nculo com <code>role=Visitor</code>. N√£o existe "valida√ß√£o" para visitante:
              √© apenas um v√≠nculo leve para acesso a conte√∫do p√∫blico e opera√ß√µes permitidas para n√£o-moradores.
            </p>
          </div>
          <div class="card">
            <h3>Pedido de moradia</h3>
            <p>
              Para virar morador, o visitante cria um pedido (JoinRequest) via
              <code>POST /api/v1/memberships/{territoryId}/become-resident</code>.
              Se ele conhecer algu√©m, pode enviar <code>recipientUserIds</code> e fazer um convite direcionado.
              Sem destinat√°rios, o pedido vai para a curadoria (Curator) e, se necess√°rio, para SystemAdmin.
            </p>
          </div>
          <div class="card">
            <h3>Aprova√ß√£o comunit√°ria</h3>
            <p>
              Destinat√°rios (ou curadores) aprovam/rejeitam via
              <code>POST /api/v1/join-requests/{id}/approve|reject</code>. Ao aprovar, o requester
              torna-se <strong>RESIDENT</strong> (ainda <strong>N√ÉO verificado</strong>).
              A verifica√ß√£o de resid√™ncia acontece depois via
              <code>POST /api/v1/memberships/{territoryId}/verify-residency/geo</code> ou
              <code>/verify-residency/document</code>.
            </p>
          </div>
          <div class="card">
            <h3>Bootstrap (primeiro morador)</h3>
            <p>
              N√£o existe "fundador" autoaprovado. Se o territ√≥rio ainda n√£o tiver curadores/moradores verificados,
              o pedido faz fallback para <strong>SystemAdmin</strong> (governan√ßa global) para destravar o bootstrap.
            </p>
          </div>
        </div>
      </section>

      <section class="section" id="territorios">
        <span class="eyebrow" data-i18n="territories.eyebrow">Territ√≥rios</span>
        <h2 data-i18n="territories.title">Unidade prim√°ria com v√≠nculo estrutural</h2>
        <div class="grid-two">
          <div class="card">
            <h3>Estado atual</h3>
            <p>
              Territ√≥rios continuam sendo a unidade prim√°ria de organiza√ß√£o. Todo conte√∫do e
              governan√ßa s√£o ancorados diretamente no territ√≥rio selecionado.
            </p>
          </div>
          <div class="card">
            <h3>ParentTerritoryId</h3>
            <p>
              O campo <code>ParentTerritoryId</code> existe apenas para modelar hierarquia estrutural
              (ex.: bairro ‚Üí munic√≠pio). Ele ainda n√£o gera heran√ßa de permiss√µes, feeds ou valida√ß√µes.
            </p>
          </div>
          <div class="card">
            <h3>Roadmap (n√£o implementado)</h3>
            <p>
              Heran√ßa de permiss√µes, feeds agregados e regras autom√°ticas por hierarquia permanecem
              como roadmap e <strong>n√£o</strong> fazem parte do backend atual.
            </p>
          </div>
        </div>
      </section>

      <section class="section" id="conceitos">
        <span class="eyebrow" data-i18n="concepts.eyebrow">Conceitos de produto</span>
        <h2 data-i18n="concepts.title">Sem√¢ntica de neg√≥cio</h2>
        <div class="grid-two">
          <div class="card">
            <h3>Territory-first</h3>
            <p>
              Territ√≥rio √© uma c√©lula geogr√°fica neutra. N√£o carrega conte√∫do social embutido; ele apenas
              organiza contexto, prioriza√ß√£o e governan√ßa.
            </p>
          </div>
          <div class="card">
            <h3>Memberships</h3>
            <p>
              V√≠nculos entre usu√°rio e territ√≥rio podem ser <strong>VISITOR</strong> ou <strong>RESIDENT</strong>.
              O pedido de moradia (JoinRequest) tem status <strong>PENDING</strong>/<strong>APPROVED</strong>/<strong>REJECTED</strong>.
              J√° a verifica√ß√£o de resid√™ncia do membership √© feita por flags: <strong>NONE</strong>/<strong>GEOVERIFIED</strong>/<strong>DOCUMENTVERIFIED</strong>,
              influenciando visibilidade e autoriza√ß√£o.
            </p>
          </div>
          <div class="card">
            <h3>Feature flags por territ√≥rio</h3>
            <p>
              Cada territ√≥rio pode habilitar flags como <strong>AlertPosts</strong>
              em <code>/api/v1/territories/{territoryId}/features</code>. Elas controlam quais tipos de post s√£o aceitos.
            </p>
          </div>
          <div class="card">
            <h3>Curadoria/Valida√ß√£o</h3>
            <p>
              A aprova√ß√£o de pedidos de moradia √© feita por <strong>Curators</strong> e/ou por moradores j√°
              verificados (geo/doc). Curadores tamb√©m continuam respons√°veis por valida√ß√£o de entidades do mapa
              e alertas ambientais.
            </p>
          </div>
          <div class="card">
            <h3>Modera√ß√£o & seguran√ßa</h3>
            <p>
              Modera√ß√£o √© um conjunto de sinais (reports) + a√ß√µes (bloqueios) para manter o territ√≥rio √∫til e
              seguro. O objetivo aqui n√£o √© "censura autom√°tica", e sim <strong>reduzir abuso e ru√≠do</strong>
              com decis√µes audit√°veis e fluxo claro de triagem por curadoria.
            </p>
            <ul>
              <li><strong>Reportar post</strong>: <code>POST /api/v1/reports/posts/{postId}</code> com <code>reason</code> (obrigat√≥rio) e <code>details</code> (opcional).</li>
              <li><strong>Reportar usu√°rio</strong>: <code>POST /api/v1/reports/users/{userId}</code> (pode receber <code>territoryId</code>).</li>
              <li><strong>Triagem</strong>: curadoria lista e filtra em <code>GET /api/v1/reports</code> (por territ√≥rio, status e tipo).</li>
              <li><strong>Bloquear/desbloquear</strong>: corta visibilidade de conte√∫do no feed e no mapa via <code>POST</code>/<code>DELETE /api/v1/blocks/users/{userId}</code>.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="modelo-dominio">
        <span class="eyebrow" data-i18n="domain.eyebrow">Modelo de dom√≠nio</span>
        <h2 data-i18n="domain.title">Entidades principais e relacionamentos</h2>
        <div class="callout">
          <strong>Diagrama do dom√≠nio:</strong> temporariamente removido (atualiza√ß√£o pendente).
        </div>

        <div class="model-grid">
          <div class="card">
            <h3>üß≠ Territ√≥rio & Configura√ß√£o</h3>
            <dl class="entity-list">
              <dt><strong>Territory</strong></dt>
              <dd>Unidade prim√°ria. Contexto para visibilidade, governan√ßa e conte√∫do.</dd>

              <dt><strong>Feature Flags</strong></dt>
              <dd>Habilitam recursos por territ√≥rio (ex.: tipos de post como AlertPosts).</dd>

              <dt><strong>SystemConfig</strong></dt>
              <dd>Par√¢metros calibr√°veis (governan√ßa e valida√ß√µes globais).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üë§ Identidade, Perfil & Prefer√™ncias</h3>
            <dl class="entity-list">
              <dt><strong>User</strong></dt>
              <dd>Identidade autenticada usada em todos os m√≥dulos.</dd>

              <dt><strong>UserProfile</strong></dt>
              <dd>Perfil do usu√°rio (ex.: display name e contato).</dd>

              <dt><strong>UserPreferences</strong></dt>
              <dd>Prefer√™ncias (privacidade e notifica√ß√µes).</dd>

              <dt><strong>2FA (TOTP)</strong></dt>
              <dd>Camada adicional de seguran√ßa para login (setup/confirm/verify).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>ü§ù Membership & Onboarding</h3>
            <dl class="entity-list">
              <dt><strong>TerritoryMembership</strong></dt>
              <dd>V√≠nculo <code>User ‚Üî Territory</code> com role (Visitor/Resident) e status de resid√™ncia.</dd>

              <dt><strong>JoinRequest</strong></dt>
              <dd>Pedido para virar residente (aprova√ß√£o/rejei√ß√£o pela comunidade/curadoria).</dd>

              <dt><strong>WorkItem</strong></dt>
              <dd>Fila gen√©rica de revis√£o humana (fallback para governan√ßa global quando necess√°rio).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üßæ Verifica√ß√£o & Evid√™ncias</h3>
            <dl class="entity-list">
              <dt><strong>Verification</strong></dt>
              <dd>Processos de verifica√ß√£o (identidade e resid√™ncia) conforme pol√≠ticas.</dd>

              <dt><strong>DocumentEvidence</strong></dt>
              <dd>Metadados de evid√™ncia (upload e download via proxy).</dd>

              <dt><strong>TerritoryWorkItems</strong></dt>
              <dd>Backlog territorial para curadoria e valida√ß√µes.</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üìù Feed & Publica√ß√µes</h3>
            <dl class="entity-list">
              <dt><strong>CommunityPost</strong></dt>
              <dd>Post do territ√≥rio, com tipo/visibilidade e autoria.</dd>

              <dt><strong>PostGeoAnchor</strong></dt>
              <dd>√Çncora geogr√°fica opcional para integrar feed e mapa.</dd>

              <dt><strong>Share</strong></dt>
              <dd>Compartilhamento de posts dentro do territ√≥rio.</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üó∫Ô∏è Mapa, Assets & Alerts</h3>
            <dl class="entity-list">
              <dt><strong>MapEntity</strong></dt>
              <dd>Entidade do mapa (pode come√ßar sugerida e ser confirmada/validada).</dd>

              <dt><strong>TerritoryAsset</strong></dt>
              <dd>Recurso territorial com geolocaliza√ß√£o obrigat√≥ria.</dd>

              <dt><strong>Alert</strong></dt>
              <dd>Alerta territorial (valida√ß√£o/curadoria, aparece em feed + mapa).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üõí Marketplace</h3>
            <dl class="entity-list">
              <dt><strong>TerritoryStore</strong></dt>
              <dd>Loja do morador no territ√≥rio.</dd>
              
              <dt><strong>Item</strong></dt>
              <dd>Produto/servi√ßo publicado pela loja (categoria, tags, pre√ßo, status).</dd>
              
              <dt><strong>Cart</strong> / <strong>CartItem</strong></dt>
              <dd>Carrinho por territ√≥rio + itens com quantidade e notas.</dd>
              
              <dt><strong>Inquiry</strong></dt>
              <dd>Mensagem de interesse em um item (inquiries enviadas/recebidas).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üí∞ Payout & Gest√£o Financeira</h3>
            <dl class="entity-list">
              <dt><strong>FinancialTransaction</strong></dt>
              <dd>Tabela central de rastreabilidade - rastreia cada centavo.</dd>

              <dt><strong>SellerBalance</strong></dt>
              <dd>Saldo do vendedor por territ√≥rio (Pending, ReadyForPayout, Paid).</dd>

              <dt><strong>SellerTransaction</strong></dt>
              <dd>Transa√ß√£o do vendedor vinculada a um checkout pago.</dd>

              <dt><strong>TerritoryPayoutConfig</strong></dt>
              <dd>Configura√ß√£o de payout por territ√≥rio (reten√ß√£o, valores m√≠nimo/m√°ximo, frequ√™ncia).</dd>

              <dt><strong>PlatformFinancialBalance</strong></dt>
              <dd>Saldo da plataforma por territ√≥rio (receitas - despesas).</dd>

              <dt><strong>PlatformRevenueTransaction</strong></dt>
              <dd>Receitas da plataforma (fees coletadas de checkouts).</dd>

              <dt><strong>PlatformExpenseTransaction</strong></dt>
              <dd>Despesas da plataforma (payouts processados para vendedores).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üìÖ Eventos</h3>
            <dl class="entity-list">
              <dt><strong>TerritoryEvent</strong></dt>
              <dd>Evento territorial com in√≠cio obrigat√≥rio, fim opcional e geolocaliza√ß√£o.</dd>
              
              <dt><strong>Interest / Confirm</strong></dt>
              <dd>Estados de engajamento: marcar interesse e confirmar presen√ßa.</dd>
              
              <dt><strong>Integra√ß√£o Feed-Mapa</strong></dt>
              <dd>Cria√ß√£o do evento alimenta feed e pins do mapa (mesmo territ√≥rio).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üí¨ Chat</h3>
            <dl class="entity-list">
              <dt><strong>Conversation</strong></dt>
              <dd>Conversas e grupos (inclui chat territorial).</dd>

              <dt><strong>ChatMessage</strong></dt>
              <dd>Mensagens com pagina√ß√£o por cursor (beforeCreatedAt / beforeMessageId). Suporta envio de imagens (1 por mensagem, m√°x. 5MB).</dd>

              <dt><strong>Participants</strong></dt>
              <dd>Participantes, pap√©is e ‚Äúread state‚Äù (marcar como lido).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üõ°Ô∏è Modera√ß√£o & Seguran√ßa</h3>
            <dl class="entity-list">
              <dt><strong>Report</strong></dt>
              <dd>Sinaliza√ß√£o de abuso (posts e usu√°rios), com motivo e detalhes.</dd>

              <dt><strong>Block</strong></dt>
              <dd>Remove visibilidade do conte√∫do produzido por um usu√°rio bloqueado.</dd>

              <dt><strong>TerritoryModerationCase</strong></dt>
              <dd>Casos de modera√ß√£o por territ√≥rio (triagem e rastreabilidade).</dd>
            </dl>
          </div>

          <div class="card">
            <h3>üîî Notifica√ß√µes</h3>
            <dl class="entity-list">
              <dt><strong>OutboxMessage</strong></dt>
              <dd>Registro transacional da inten√ß√£o de notificar.</dd>

              <dt><strong>UserNotification</strong></dt>
              <dd>Inbox in-app por usu√°rio (listar e marcar como lida).</dd>
            </dl>
          </div>

          <div class="card card-full">
            <h3>üí° Por que essa estrutura existe</h3>
            <ul class="rationale-list">
              <li><strong>Separa√ß√£o de responsabilidades:</strong> Territ√≥rio separado de identidade evita acoplamento social no mapa</li>
              <li><strong>Governan√ßa clara:</strong> V√≠nculos explicitam presen√ßa local e governan√ßa comunit√°ria</li>
              <li><strong>Integra√ß√£o feed-mapa:</strong> Posts + geo anchors conectam feed e mapa sem confundir o dom√≠nio</li>
              <li><strong>Economia local:</strong> Marketplace permite economia dentro do territ√≥rio</li>
              <li><strong>Engajamento:</strong> Eventos conectam comunidade com atividades locais</li>
              <li><strong>Confian√ßa:</strong> Modera√ß√£o mant√©m confian√ßa com regras audit√°veis</li>
              <li><strong>Confiabilidade:</strong> Notifica√ß√µes usam outbox para evitar perda de eventos ap√≥s commit</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="fluxos">
        <span class="eyebrow" data-i18n="flows.eyebrow">Fluxos principais</span>
        <h2 data-i18n="flows.title">Sequ√™ncias orientadas a produto e API</h2>

        <div class="flow-step">
          <h4>1. Autentica√ß√£o social ‚Üí JWT</h4>
          <p>
            Use <code>POST /api/v1/auth/social</code> com <code>Provider</code>, <code>ExternalId</code>, <code>DisplayName</code>
            e <strong>CPF</strong> ou <strong>ForeignDocument</strong>. A resposta traz o token JWT.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "google",
    "externalId": "abc-123",
    "displayName": "Ana Souza",
    "cpf": "12345678900",
    "email": "ana@exemplo.com"
  }'</code></pre>
          <details class="sequence-diagram-toggle">
            <summary class="sequence-diagram-summary">
              <span>üìä Ver Diagrama de Sequ√™ncia</span>
            </summary>
            <div class="sequence-diagram-container">
              <div class="mermaid" data-diagram="auth">
sequenceDiagram
    participant Cliente
    participant AuthController
    participant AuthService
    participant UserRepository
    participant TokenService
    participant Database

    Cliente->>AuthController: POST /api/v1/auth/social
    AuthController->>AuthService: LoginSocialAsync()
    
    AuthService->>UserRepository: GetByAuthProviderAsync()
    UserRepository->>Database: SELECT user WHERE provider + externalId
    Database-->>UserRepository: User ou null
    UserRepository-->>AuthService: User existente ou null
    
    alt Usu√°rio j√° existe
        alt 2FA habilitado
            AuthService-->>AuthController: Result.Failure("2FA_REQUIRED")
            AuthController-->>Cliente: 400 Bad Request (2FA_REQUIRED)
        else 2FA n√£o habilitado
            AuthService->>TokenService: IssueToken(userId)
            TokenService-->>AuthService: JWT Token
            AuthService-->>AuthController: Result.Success(user, token)
            AuthController-->>Cliente: 200 OK (user, token)
        end
    else Novo usu√°rio
        AuthService->>UserRepository: AddAsync(new User())
        UserRepository->>Database: INSERT user
        Database-->>UserRepository: User criado
        UserRepository-->>AuthService: User
        AuthService->>TokenService: IssueToken(userId)
        TokenService-->>AuthService: JWT Token
        AuthService-->>AuthController: Result.Success(user, token)
        AuthController-->>Cliente: 200 OK (user, token)
    end
              </div>
            </div>
          </details>
        </div>

        <div class="flow-step">
          <h4>2. Descoberta de territ√≥rio</h4>
          <p>
            <code>GET /api/v1/territories</code> lista territ√≥rios dispon√≠veis. Para busca, use
            <code>/search</code> ou <code>/nearby</code> com <code>lat</code> e <code>lng</code>.
          </p>
          <pre class="code-block"><code>curl "http://localhost:8080/api/v1/territories/nearby?lat=-23.55&amp;lng=-46.63&amp;radiusKm=10"</code></pre>
          <details class="sequence-diagram-toggle">
            <summary class="sequence-diagram-summary">
              <span>üìä Ver Diagrama de Sequ√™ncia</span>
            </summary>
            <div class="sequence-diagram-container">
              <div class="mermaid" data-diagram="territory-discovery">
sequenceDiagram
    participant Cliente
    participant TerritoryController
    participant MembershipController
    participant TerritoryService
    participant MembershipService
    participant TerritoryRepository
    participant MembershipRepository
    participant SettingsRepository
    participant AuditLogger
    participant Database

    Cliente->>TerritoryController: GET /api/v1/territories/nearby
    TerritoryController->>TerritoryService: FindNearbyAsync()
    TerritoryService->>TerritoryRepository: FindNearbyAsync()
    TerritoryRepository->>Database: SELECT territories WHERE distance < radiusKm
    Database-->>TerritoryRepository: List<Territory>
    TerritoryRepository-->>TerritoryService: List<Territory>
    TerritoryService-->>TerritoryController: List<Territory>
    TerritoryController-->>Cliente: 200 OK (territories)

    Cliente->>MembershipController: POST /api/v1/memberships/{territoryId}/enter-visitor
    MembershipController->>MembershipService: EnterAsVisitorAsync(userId, territoryId)
    
    MembershipService->>MembershipRepository: GetByUserAndTerritoryAsync()
    MembershipRepository->>Database: SELECT membership WHERE userId + territoryId
    Database-->>MembershipRepository: Membership ou null
    MembershipRepository-->>MembershipService: Membership existente ou null
    
    alt Membership j√° existe
        MembershipService-->>MembershipController: Membership existente
    else Novo membership
        MembershipService->>MembershipRepository: AddAsync(new TerritoryMembership(Visitor))
        MembershipRepository->>Database: INSERT membership
        Database-->>MembershipRepository: Membership criado
        
        MembershipService->>SettingsRepository: AddAsync(new MembershipSettings())
        SettingsRepository->>Database: INSERT settings
        Database-->>SettingsRepository: Settings criado
        
        MembershipService->>AuditLogger: LogAsync("membership.declared")
        MembershipService->>MembershipService: CommitAsync()
        MembershipService-->>MembershipController: TerritoryMembership
    end
    
    MembershipController-->>Cliente: 200 OK (membership)
              </div>
            </div>
          </details>
        </div>

        <div class="flow-step" id="territory-selection">
          <h4>3. Sele√ß√£o de territ√≥rio (sess√£o)</h4>
          <p>
            Defina o territ√≥rio ativo com <code>POST /api/v1/territories/selection</code> usando
            <code>X-Session-Id</code>. Esse header substitui o <code>territoryId</code> em v√°rias rotas.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/territories/selection \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{"territoryId": "11111111-1111-1111-1111-111111111111"}'</code></pre>
        </div>

        <div class="flow-step">
          <h4>4. Feed territorial</h4>
          <p>
            <code>GET /api/v1/feed</code> retorna posts filtrados pelo territ√≥rio ativo. Visitantes veem
            apenas posts p√∫blicos publicados. Moradores veem conte√∫do ampliado.
          </p>
          <pre class="code-block"><code>curl http://localhost:8080/api/v1/feed \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "X-Session-Id: session-123"</code></pre>
          <details class="sequence-diagram-toggle">
            <summary class="sequence-diagram-summary">
              <span>üìä Ver Diagrama de Sequ√™ncia</span>
            </summary>
            <div class="sequence-diagram-container">
              <div class="mermaid" data-diagram="feed-listing">
sequenceDiagram
    participant Cliente
    participant FeedController
    participant FeedService
    participant PostFilterService
    participant FeedRepository
    participant AccessEvaluator
    participant UserBlockRepository
    participant EventService
    participant Database

    Cliente->>FeedController: GET /api/v1/feed/paged
    FeedController->>FeedService: ListForTerritoryPagedAsync()
    FeedService->>FeedRepository: ListByTerritoryAsync(territoryId)
    FeedRepository->>Database: SELECT posts WHERE territoryId ORDER BY createdAt DESC
    Database-->>FeedRepository: List<CommunityPost>
    FeedRepository-->>FeedService: List<CommunityPost>
    
    FeedService->>PostFilterService: FilterAndPaginateAsync(posts, userId)
    
    PostFilterService->>AccessEvaluator: GetMembershipAsync(userId, territoryId)
    AccessEvaluator->>Database: SELECT membership WHERE userId + territoryId
    Database-->>AccessEvaluator: Membership
    AccessEvaluator-->>PostFilterService: Membership (role, verification)
    
    PostFilterService->>UserBlockRepository: GetBlockedUserIdsAsync(userId)
    UserBlockRepository->>Database: SELECT blocked_user_ids WHERE userId
    Database-->>UserBlockRepository: List<Guid>
    UserBlockRepository-->>PostFilterService: BlockedUserIds
    
    PostFilterService->>PostFilterService: Aplicar filtros:\n- Bloqueios\n- Visibilidade\n- Status\n- Pagina√ß√£o
    
    PostFilterService-->>FeedService: PagedResult<CommunityPost>
    FeedService-->>FeedController: PagedResult<CommunityPost>
    
    FeedController->>EventService: LoadEventSummariesAsync(postIds)
    FeedController->>FeedService: GetCountsByPostIdsAsync(postIds)
    FeedController->>FeedController: Montar FeedItemResponse
    FeedController-->>Cliente: 200 OK (PagedResponse<FeedItemResponse>)
              </div>
            </div>
          </details>
        </div>

        <div class="flow-step">
          <h4>5. Criar post + √¢ncoras geogr√°ficas + m√≠dias</h4>
          <p>
            Para criar post use <code>POST /api/v1/feed</code>. As √¢ncoras geogr√°ficas s√£o opcionais e
            posts s√£o criados por moradores. Posts podem incluir at√© 10 imagens atrav√©s do campo <code>mediaIds</code>.
            Eventos s√£o criados via <code>POST /api/v1/events</code>,
            com data/hora e geolocaliza√ß√£o obrigat√≥ria, e aparecem no feed e no mapa.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/feed \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{
    "title": "Mutir√£o de limpeza",
    "content": "Encontro s√°bado 9h.",
    "type": "General",
    "visibility": "Public",
    "mapEntityId": null,
    "geoAnchors": [{"latitude": -23.55, "longitude": -46.63, "type": "POST"}],
    "assetIds": ["aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"],
    "mediaIds": ["bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb", "cccccccc-cccc-cccc-cccc-cccccccccccc"]
  }'</code></pre>
          <div style="margin-top: 1rem; padding: 1rem; background: #1a2a3a; border-radius: 0.5rem;">
            <strong>üì∏ M√≠dias em Posts:</strong>
            <ul style="margin-top: 0.5rem; line-height: 1.8;">
              <li><strong>Upload de m√≠dia</strong>: Primeiro, fa√ßa upload via <code>POST /api/v1/media/upload</code> para obter o <code>mediaId</code></li>
              <li><strong>Associar ao post</strong>: Inclua os <code>mediaIds</code> no array ao criar o post (m√°ximo 10 imagens)</li>
              <li><strong>Resposta</strong>: O <code>FeedItemResponse</code> inclui <code>mediaUrls</code> (array de URLs) e <code>mediaCount</code></li>
              <li><strong>Valida√ß√£o</strong>: Todas as m√≠dias devem pertencer ao usu√°rio que est√° criando o post</li>
            </ul>
          </div>
          <details class="sequence-diagram-toggle">
            <summary class="sequence-diagram-summary">
              <span>üìä Ver Diagrama de Sequ√™ncia</span>
            </summary>
            <div class="sequence-diagram-container">
              <div class="mermaid" data-diagram="post-creation">
sequenceDiagram
    participant Cliente
    participant FeedController
    participant FeedService
    participant PostCreationService
    participant AccessEvaluator
    participant FeatureFlagService
    participant SanctionRepository
    participant AssetRepository
    participant FeedRepository
    participant PostGeoAnchorRepository
    participant EventBus
    participant Database

    Cliente->>FeedController: POST /api/v1/feed
    FeedController->>AccessEvaluator: IsResidentAsync(userId, territoryId)
    AccessEvaluator->>Database: SELECT membership WHERE userId + territoryId
    Database-->>AccessEvaluator: Membership
    AccessEvaluator-->>FeedController: isResident
    
    alt N√£o √© Resident
        FeedController-->>Cliente: 401 Unauthorized
    else √â Resident
        FeedController->>FeedService: CreatePostAsync()
        FeedService->>PostCreationService: CreatePostAsync()
        
        PostCreationService->>FeatureFlagService: IsEnabledAsync(territoryId, "AlertPosts")
        PostCreationService->>SanctionRepository: HasActiveSanctionAsync(userId, PostingRestriction)
        SanctionRepository->>Database: SELECT sanction WHERE userId + territoryId
        Database-->>SanctionRepository: Sanction ou null
        
        alt Usu√°rio com restri√ß√£o
            PostCreationService-->>FeedService: Result.Failure("Posting restricted")
            FeedService-->>FeedController: Result.Failure
            FeedController-->>Cliente: 400 Bad Request
        else Pode postar
            PostCreationService->>FeedRepository: AddAsync(new CommunityPost())
            FeedRepository->>Database: INSERT post
            Database-->>FeedRepository: Post criado
            
            loop Para cada GeoAnchor
                PostCreationService->>PostGeoAnchorRepository: AddAsync(new PostGeoAnchor())
                PostGeoAnchorRepository->>Database: INSERT geo_anchor
            end
            
            PostCreationService->>EventBus: PublishAsync(PostCreatedEvent)
            PostCreationService->>PostCreationService: CommitAsync()
            PostCreationService-->>FeedService: Result.Success(post)
            FeedService-->>FeedController: Result.Success(post)
            FeedController-->>Cliente: 201 Created (post)
        end
    end
              </div>
            </div>
          </details>
        </div>

        <div class="flow-step">
          <h4>6. Assets territoriais (com geolocaliza√ß√£o obrigat√≥ria)</h4>
          <p>
            Assets sempre possuem ao menos uma √¢ncora geogr√°fica e s√£o exibidos no mapa via pins do tipo
            <code>asset</code>. Somente moradores validados ou curadores podem criar/editar/arquivar.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/assets \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "type": "river",
    "name": "Rio do Vale",
    "description": "Trecho monitorado",
    "geoAnchors": [{"latitude": -23.55, "longitude": -46.63}]
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>7. Alertas ambientais (feed + mapa)</h4>
          <p>
            Alertas usam <code>/api/v1/alerts</code> e aparecem no feed e no mapa (pins do tipo
            <code>alert</code>) quando validados por curadores.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/alerts \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{"title": "Queimada", "description": "Fuma√ßa pr√≥xima √† nascente"}'</code></pre>
        </div>

        <div class="flow-step">
          <h4>8. Mapa: entidades, pins e valida√ß√£o</h4>
          <p>
            Use <code>GET /api/v1/map/entities</code> e <code>/pins</code> para visualizar. Sugest√µes usam
            <code>POST /api/v1/map/entities</code> (categorias: estabelecimento, √≥rg√£o do governo, espa√ßo p√∫blico,
            espa√ßo natural). Confirma√ß√µes usam <code>/confirmations</code> e valida√ß√µes <code>/validation</code>
            s√£o exclusivas para curadores. Pins aceitam filtros por <code>types</code>, <code>assetId</code> e
            <code>assetTypes</code>.
          </p>
          <pre class="code-block"><code>curl http://localhost:8080/api/v1/map/pins?types=asset,alert,entity \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "X-Session-Id: session-123"</code></pre>
        </div>

        <div class="flow-step">
          <h4>9. Membership: visitor ‚Üí resident</h4>
          <p>
            O visitante solicita resid√™ncia via
            <code>POST /api/v1/memberships/{territoryId}/become-resident</code> (convite direcionado via <code>recipientUserIds</code> ou fila de curadoria).
            Destinat√°rios (ou curadores) aprovam em
            <code>POST /api/v1/join-requests/{id}/approve</code>, promovendo para
            <strong>RESIDENT</strong> (com <strong>ResidencyVerification=NONE</strong>).
            O status atual do v√≠nculo est√° em <code>GET /api/v1/memberships/{territoryId}/me</code>.
            Para verificar resid√™ncia (geo/doc), use <code>/verify-residency/geo</code> ou <code>/verify-residency/document</code>.
            Quando a policy exige presen√ßa, envie <code>X-Geo-Latitude</code>/<code>X-Geo-Longitude</code>.
          </p>
          <details class="sequence-diagram-toggle">
            <summary class="sequence-diagram-summary">
              <span>üìä Ver Diagrama de Sequ√™ncia</span>
            </summary>
            <div class="sequence-diagram-container">
              <div class="mermaid" data-diagram="membership-resident">
sequenceDiagram
    participant Cliente
    participant MembershipController
    participant MembershipService
    participant MembershipRepository
    participant VerificationQueueService
    participant WorkQueueService
    participant DocumentEvidenceService
    participant FileStorage
    participant Database

    Cliente->>MembershipController: POST /api/v1/memberships/{territoryId}/become-resident
    MembershipController->>MembershipService: BecomeResidentAsync(userId, territoryId)
    
    MembershipService->>MembershipRepository: GetResidentMembershipAsync()
    MembershipRepository->>Database: SELECT membership WHERE userId AND role=Resident
    Database-->>MembershipRepository: Membership ou null
    
    alt J√° √© Resident em outro territ√≥rio
        MembershipService-->>MembershipController: Result.Failure("Already resident elsewhere")
        MembershipController-->>Cliente: 400 Bad Request
    else Pode tornar-se Resident
        MembershipService->>MembershipRepository: UpdateRole(Resident)
        MembershipRepository->>Database: UPDATE membership SET role=Resident
        Database-->>MembershipRepository: OK
        
        MembershipService->>MembershipService: CommitAsync()
        MembershipService-->>MembershipController: Result.Success(membership)
        MembershipController-->>Cliente: 200 OK (membership)
    end

    Note over Cliente,Database: Upload de documento (opcional)
    Cliente->>MembershipController: POST /api/v1/memberships/{territoryId}/verify-residency/document/upload
    MembershipController->>DocumentEvidenceService: UploadDocumentAsync()
    DocumentEvidenceService->>FileStorage: UploadAsync(file)
    FileStorage-->>DocumentEvidenceService: File URL
    DocumentEvidenceService->>Database: INSERT document_evidence
    Database-->>DocumentEvidenceService: Evidence criada
    
    DocumentEvidenceService->>VerificationQueueService: EnqueueResidencyVerification()
    VerificationQueueService->>WorkQueueService: EnqueueWorkItem(ResidencyVerification)
    WorkQueueService->>Database: INSERT work_item
    Database-->>WorkQueueService: WorkItem criado
    
    DocumentEvidenceService-->>MembershipController: Evidence + WorkItem
    MembershipController-->>Cliente: 200 OK (evidenceId, workItemId)
              </div>
            </div>
          </details>
        </div>

        <div class="flow-step">
          <h4>10. Modera√ß√£o & seguran√ßa: reports, triagem e bloqueios</h4>
          <p>
            O fluxo t√≠pico √©: (1) um usu√°rio reporta; (2) a curadoria lista reports do territ√≥rio e prioriza;
            (3) quando necess√°rio, aplica bloqueio para cortar propaga√ß√£o do conte√∫do no feed e no mapa.
            Reports usam <code>reason</code> (obrigat√≥rio) e <code>details</code> (opcional).
          </p>
          <pre class="code-block"><code># Reportar um post
curl -X POST http://localhost:8080/api/v1/reports/posts/{postId} \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{"reason":"Spam","details":"Link suspeito no conte√∫do"}'

# Reportar um usu√°rio (opcionalmente por territ√≥rio)
curl -X POST "http://localhost:8080/api/v1/reports/users/{userId}?territoryId=11111111-1111-1111-1111-111111111111" \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{"reason":"Abuso","details":"Comportamento inadequado"}'

# Curadoria lista reports para triagem
curl "http://localhost:8080/api/v1/reports?territoryId=11111111-1111-1111-1111-111111111111&amp;status=Open" \
  -H "Authorization: Bearer &lt;token&gt;"

# Bloquear / desbloquear um usu√°rio
curl -X POST http://localhost:8080/api/v1/blocks/users/{userId} \
  -H "Authorization: Bearer &lt;token&gt;"

curl -X DELETE http://localhost:8080/api/v1/blocks/users/{userId} \
  -H "Authorization: Bearer &lt;token&gt;"</code></pre>
          <details class="sequence-diagram-toggle">
            <summary class="sequence-diagram-summary">
              <span>üìä Ver Diagrama de Sequ√™ncia</span>
            </summary>
            <div class="sequence-diagram-container">
              <div class="mermaid" data-diagram="moderation">
sequenceDiagram
    participant Cliente
    participant ModerationController
    participant ModerationService
    participant ReportService
    participant WorkQueueService
    participant ModerationCaseService
    participant SanctionRepository
    participant AuditLogger
    participant EventBus
    participant Database

    Cliente->>ModerationController: POST /api/v1/reports (targetType, targetId, reason)
    ModerationController->>ReportService: CreateReportAsync()
    
    ReportService->>Database: INSERT report
    Database-->>ReportService: Report criado
    
    ReportService->>WorkQueueService: EnqueueWorkItem(ModerationCase)
    WorkQueueService->>Database: INSERT work_item
    Database-->>WorkQueueService: WorkItem criado
    
    ReportService->>AuditLogger: LogAsync("report.created")
    ReportService->>EventBus: PublishAsync(ReportCreatedEvent)
    ReportService->>ReportService: CommitAsync()
    ReportService-->>ModerationController: Report
    ModerationController-->>Cliente: 201 Created (report)

    Note over Cliente,Database: Decis√£o de Modera√ß√£o (Curator/Moderator)
    Cliente->>ModerationController: POST /api/v1/territories/{territoryId}/work-items/{workItemId}/complete
    ModerationController->>ModerationCaseService: CompleteModerationCaseAsync()
    
    ModerationCaseService->>WorkQueueService: GetWorkItemAsync(workItemId)
    WorkQueueService->>Database: SELECT work_item WHERE id
    Database-->>WorkQueueService: WorkItem
    
    ModerationCaseService->>ReportService: GetByIdAsync(reportId)
    ReportService->>Database: SELECT report WHERE id
    Database-->>ReportService: Report
    
    alt Decis√£o: Aplicar San√ß√£o
        ModerationCaseService->>SanctionRepository: AddAsync(new Sanction())
        SanctionRepository->>Database: INSERT sanction
        ModerationCaseService->>EventBus: PublishAsync(SanctionAppliedEvent)
    end
    
    ModerationCaseService->>ReportService: UpdateStatusAsync(reportId, Resolved)
    ReportService->>Database: UPDATE report SET status=Resolved
    ModerationCaseService->>WorkQueueService: CompleteWorkItemAsync(workItemId, outcome)
    ModerationCaseService->>AuditLogger: LogAsync("moderation.completed")
    ModerationCaseService->>ModerationCaseService: CommitAsync()
    ModerationCaseService-->>ModerationController: Result.Success
    ModerationController-->>Cliente: 200 OK
              </div>
            </div>
          </details>
        </div>

        <div class="flow-step">
          <h4>11. Notifica√ß√µes in-app</h4>
          <p>
            Eventos relevantes geram mensagens em outbox que s√£o processadas em background para criar
            notifica√ß√µes por usu√°rio. Consulte <code>GET /api/v1/notifications</code> e marque como lidas em
            <code>POST /api/v1/notifications/{id}/read</code>.
          </p>
        </div>

        <div class="flow-step">
          <h4>11a. Enviar mensagem no chat com imagem</h4>
          <p>
            O chat permite enviar imagens junto com mensagens de texto. Cada mensagem pode conter uma imagem
            (m√°ximo 5MB, apenas imagens). Primeiro fa√ßa upload da imagem via <code>POST /api/v1/media/upload</code>
            e depois inclua o <code>mediaId</code> ao enviar a mensagem.
          </p>
          <pre class="code-block"><code># 1) Upload da imagem
curl -X POST http://localhost:8080/api/v1/media/upload \
  -H "Authorization: Bearer &lt;token&gt;" \
  -F "file=@imagem.jpg"

# 2) Enviar mensagem com imagem
curl -X POST http://localhost:8080/api/v1/chat/conversations/{conversationId}/messages \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Olha essa foto!",
    "mediaId": "gggggggg-gggg-gggg-gggg-gggggggggggg"
  }'</code></pre>
          <div style="margin-top: 1rem; padding: 1rem; background: #1a2a3a; border-radius: 0.5rem;">
            <strong>üí¨ M√≠dias em Chat:</strong>
            <ul style="margin-top: 0.5rem; line-height: 1.8;">
              <li><strong>Upload de m√≠dia</strong>: Use <code>POST /api/v1/media/upload</code> para fazer upload da imagem</li>
              <li><strong>Enviar mensagem</strong>: Inclua o <code>mediaId</code> no campo opcional ao enviar mensagem</li>
              <li><strong>Limite</strong>: 1 imagem por mensagem, m√°ximo 5MB, apenas imagens (n√£o v√≠deos)</li>
              <li><strong>Resposta</strong>: O <code>MessageResponse</code> inclui <code>mediaUrl</code> e <code>hasMedia</code></li>
              <li><strong>Valida√ß√£o</strong>: A m√≠dia deve pertencer ao usu√°rio que est√° enviando a mensagem</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="casos-de-uso">
        <span class="eyebrow" data-i18n="usecases.eyebrow">Casos de uso</span>
        <h2 data-i18n="usecases.title">Como usar a API (cen√°rios pr√°ticos)</h2>
        <p data-i18n-html="usecases.leadHtml">
          Estes cen√°rios conectam objetivo ‚Üí pr√©-requisitos ‚Üí endpoints. Em geral, voc√™ vai precisar de um JWT
          e de um territ√≥rio selecionado via <code>X-Session-Id</code>.
        </p>
        <div class="grid-two">
          <div class="card">
            <h3>Onboarding (primeiro acesso)</h3>
            <ul>
              <li><strong>Autenticar</strong>: <code>POST /api/v1/auth/social</code></li>
              <li><strong>Descobrir territ√≥rio</strong>: <code>GET /api/v1/territories</code> (ou <code>/nearby</code>)</li>
              <li><strong>Selecionar territ√≥rio</strong>: <code>POST /api/v1/territories/selection</code> + <code>X-Session-Id</code></li>
              <li><strong>Checar membership</strong>: <code>GET /api/v1/memberships/{territoryId}/me</code></li>
            </ul>
          </div>
          <div class="card">
            <h3>Publicar conte√∫do (feed + mapa + m√≠dias)</h3>
            <ul>
              <li><strong>Ler feed</strong>: <code>GET /api/v1/feed</code></li>
              <li><strong>Criar post</strong>: <code>POST /api/v1/feed</code> (com <code>geoAnchors</code> opcionais e <code>mediaIds</code> para at√© 10 imagens)</li>
              <li><strong>Upload de m√≠dia</strong>: <code>POST /api/v1/media/upload</code> para obter <code>mediaId</code></li>
              <li><strong>Ver pins</strong>: <code>GET /api/v1/map/pins</code> (tipos: entity/asset/alert/post)</li>
            </ul>
          </div>
          <div class="card">
            <h3>Opera√ß√µes territoriais (assets/alerts)</h3>
            <ul>
              <li><strong>Criar asset</strong>: <code>POST /api/v1/assets</code> (geo obrigat√≥ria)</li>
              <li><strong>Criar alerta</strong>: <code>POST /api/v1/alerts</code> (valida√ß√£o por curadoria)</li>
              <li><strong>Listar pins</strong>: <code>GET /api/v1/map/pins?types=asset,alert</code></li>
            </ul>
          </div>
          <div class="card">
            <h3>Economia local e eventos (com m√≠dias)</h3>
            <ul>
              <li><strong>Loja</strong>: <code>POST /api/v1/stores</code></li>
              <li><strong>Items (produtos/servi√ßos)</strong>: <code>POST /api/v1/items</code> com <code>mediaIds</code> (at√© 10 imagens) e <code>GET /api/v1/items</code></li>
              <li><strong>Carrinho</strong>: <code>POST /api/v1/cart/items</code> e <code>POST /api/v1/cart/checkout</code></li>
              <li><strong>Evento</strong>: <code>POST /api/v1/events</code> com <code>coverMediaId</code> e <code>additionalMediaIds</code>, <code>POST /api/v1/events/{eventId}/interest</code>, <code>POST /api/v1/events/{eventId}/confirm</code></li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="marketplace">
        <span class="eyebrow" data-i18n="marketplace.eyebrow">Marketplace</span>
        <h2 data-i18n="marketplace.title">Economia local territorial</h2>
        <p data-i18n="marketplace.lead">
          O marketplace permite criar lojas e publicar produtos/servi√ßos (items), gerenciar carrinho de compras
          e recebam inquiries de interessados. Tudo ancorado no territ√≥rio.
        </p>

        <div class="flow-step">
          <h4>12. Criar ou atualizar loja</h4>
          <p>
            Moradores validados podem criar ou atualizar sua loja no territ√≥rio via
            <code>POST /api/v1/stores</code>. A loja define informa√ß√µes de contato e visibilidade.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/stores \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "displayName": "Loja da Ana",
    "description": "Produtos artesanais",
    "contactVisibility": "Public",
    "contact": {
      "phone": "+5511999999999",
      "email": "ana@exemplo.com"
    }
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>13. Criar item (produto ou servi√ßo) com imagens</h4>
          <p>
            Lojas podem criar items via <code>POST /api/v1/items</code>. Items podem ser produtos
            ou servi√ßos, com pre√ßo fixo, negoci√°vel ou gratuito. Items podem incluir at√© 10 imagens atrav√©s do campo <code>mediaIds</code>.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/items \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "storeId": "22222222-2222-2222-2222-222222222222",
    "type": "Product",
    "title": "Bolo de chocolate",
    "description": "Bolo caseiro",
    "category": "Alimentos",
    "tags": "bolo,chocolate",
    "pricingType": "Fixed",
    "priceAmount": 25.00,
    "currency": "BRL",
    "unit": "unidade",
    "latitude": -23.55,
    "longitude": -46.63,
    "mediaIds": ["dddddddd-dddd-dddd-dddd-dddddddddddd", "eeeeeeee-eeee-eeee-eeee-eeeeeeeeeeee"]
  }'</code></pre>
          <div style="margin-top: 1rem; padding: 1rem; background: #1a2a3a; border-radius: 0.5rem;">
            <strong>üì∏ M√≠dias em Items:</strong>
            <ul style="margin-top: 0.5rem; line-height: 1.8;">
              <li><strong>Upload de m√≠dia</strong>: Primeiro, fa√ßa upload via <code>POST /api/v1/media/upload</code> para obter o <code>mediaId</code></li>
              <li><strong>Associar ao item</strong>: Inclua os <code>mediaIds</code> no array ao criar o item (m√°ximo 10 imagens)</li>
              <li><strong>Imagem principal</strong>: A primeira imagem do array √© usada como <code>primaryImageUrl</code></li>
              <li><strong>Resposta</strong>: O <code>ItemResponse</code> inclui <code>primaryImageUrl</code> e <code>imageUrls</code> (array com todas as imagens)</li>
            </ul>
          </div>
        </div>

        <div class="flow-step">
          <h4>14. Buscar items</h4>
          <p>
            Use <code>GET /api/v1/items</code> para buscar produtos e servi√ßos por territ√≥rio, categoria,
            tags ou texto livre (<code>q</code>).
          </p>
          <pre class="code-block"><code>curl "http://localhost:8080/api/v1/items?territoryId=11111111-1111-1111-1111-111111111111&amp;q=bolo&amp;category=Alimentos" \
  -H "Authorization: Bearer &lt;token&gt;"</code></pre>
        </div>

        <div class="flow-step">
          <h4>15. Gerenciar carrinho</h4>
          <p>
            Usu√°rios podem adicionar itens ao carrinho via <code>POST /api/v1/cart/items</code>,
            atualizar quantidade via <code>PATCH /api/v1/cart/items/{id}</code> e fazer checkout via
            <code>POST /api/v1/cart/checkout</code>.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/cart/items \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "itemId": "33333333-3333-3333-3333-333333333333",
    "quantity": 2,
    "notes": "Entregar ap√≥s 18h (se poss√≠vel)"
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>16. Criar inquiry</h4>
          <p>
            Interessados podem criar inquiries diretamente em items via
            <code>POST /api/v1/items/{id}/inquiries</code>.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/items/{id}/inquiries \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{"message": "Gostaria de mais informa√ß√µes"}'</code></pre>
        </div>
      </section>

      <section class="section" id="payout-gestao-financeira">
        <span class="eyebrow">Payout & Gest√£o Financeira</span>
        <h2>Sistema de Payout e Rastreabilidade Financeira Completa</h2>
        <p>
          O Araponga implementa um sistema completo de payout (transfer√™ncia para vendedores) com rastreabilidade
          financeira total. Cada centavo √© rastreado, permitindo transpar√™ncia total e autonomia para territ√≥rios.
        </p>

        <div class="grid-two">
          <div class="card">
            <h3>üéØ O que √© o Sistema de Payout?</h3>
            <p>
              Quando um checkout √© marcado como <code>Paid</code>, o sistema automaticamente cria uma transa√ß√£o
              de vendedor e processa o payout conforme configura√ß√µes do territ√≥rio. O vendedor recebe o valor
              l√≠quido (subtotal - fees da plataforma).
            </p>
          </div>
          <div class="card">
            <h3>‚ú® Principais Funcionalidades</h3>
            <ul>
              <li>‚úÖ <strong>Rastreabilidade completa</strong>: Cada centavo √© rastreado em <code>FinancialTransaction</code></li>
              <li>‚úÖ <strong>Reten√ß√£o configur√°vel</strong>: Aguarda per√≠odo configurado antes de liberar para payout</li>
              <li>‚úÖ <strong>Valor m√≠nimo/m√°ximo</strong>: Acumula at√© atingir m√≠nimo ou divide se exceder m√°ximo</li>
              <li>‚úÖ <strong>Payout autom√°tico</strong>: Background worker processa payouts automaticamente</li>
              <li>‚úÖ <strong>Gest√£o financeira da plataforma</strong>: Saldo, receitas e despesas separadas por territ√≥rio</li>
            </ul>
          </div>
        </div>

        <div class="callout" style="background: #1a2a3a; border-left: 4px solid #7cd1ff; padding: 1rem; margin: 2rem 0;">
          <strong>üöÄ Guia de Produ√ß√£o (Passo a Passo)</strong>
          <p style="margin-top: 0.5rem;">
            Abaixo voc√™ encontrar√° um guia completo para colocar o sistema de payout em produ√ß√£o. O guia foi
            projetado para ser seguido por qualquer pessoa, mesmo com conhecimento m√≠nimo de programa√ß√£o.
          </p>
        </div>

        <div class="flow-step">
          <h4>üìã Passo 1: Entendendo o Fluxo de Payout</h4>
          <p>
            Quando um cliente compra algo na loja de um vendedor e o pagamento √© confirmado, o seguinte acontece:
          </p>
          <ol style="margin-left: 1.5rem; line-height: 1.8;">
            <li><strong>Checkout pago</strong> ‚Üí Sistema cria <code>SellerTransaction</code> automaticamente</li>
            <li><strong>Valor l√≠quido</strong> ‚Üí Subtotal - Fees da plataforma = Valor para o vendedor</li>
            <li><strong>Per√≠odo de reten√ß√£o</strong> ‚Üí Aguarda dias configurados (ex: 7 dias)</li>
            <li><strong>Valor m√≠nimo</strong> ‚Üí Acumula at√© atingir valor m√≠nimo configurado (ex: R$ 100,00)</li>
            <li><strong>Payout autom√°tico</strong> ‚Üí Background worker processa quando todas as condi√ß√µes s√£o atendidas</li>
            <li><strong>Transfer√™ncia</strong> ‚Üí Dinheiro √© transferido para o vendedor via gateway (Stripe, MercadoPago, etc.)</li>
          </ol>
        </div>

        <div class="flow-step">
          <h4>‚öôÔ∏è Passo 2: Configurar Payout para um Territ√≥rio</h4>
          <p>
            Antes de usar o sistema de payout, voc√™ precisa configurar como ele funciona para cada territ√≥rio.
            Essa configura√ß√£o define per√≠odo de reten√ß√£o, valores m√≠nimo/m√°ximo, frequ√™ncia e se requer aprova√ß√£o manual.
          </p>
          <pre class="code-block"><code># Criar ou atualizar configura√ß√£o de payout
curl -X POST "http://localhost:8080/api/v1/territories/{territoryId}/payout-config" \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "retentionPeriodDays": 7,
    "minimumPayoutAmountInCents": 10000,
    "maximumPayoutAmountInCents": 5000000,
    "frequency": "Weekly",
    "autoPayoutEnabled": true,
    "requiresApproval": false,
    "currency": "BRL"
  }'</code></pre>
          <div style="margin-top: 1rem; padding: 1rem; background: #1a2a3a; border-radius: 0.5rem;">
            <strong>üìù Explica√ß√£o dos Campos:</strong>
            <ul style="margin-top: 0.5rem; line-height: 1.8;">
              <li><code>retentionPeriodDays</code>: Quantos dias aguardar antes de liberar para payout (ex: 7 = aguarda 7 dias)</li>
              <li><code>minimumPayoutAmountInCents</code>: Valor m√≠nimo em centavos para processar payout (ex: 10000 = R$ 100,00)</li>
              <li><code>maximumPayoutAmountInCents</code>: Valor m√°ximo por payout - se exceder, divide em m√∫ltiplos (ex: 5000000 = R$ 50.000,00)</li>
              <li><code>frequency</code>: Frequ√™ncia do payout autom√°tico - <code>"Daily"</code>, <code>"Weekly"</code>, <code>"Monthly"</code> ou <code>"Manual"</code></li>
              <li><code>autoPayoutEnabled</code>: Se <code>true</code>, processa payouts automaticamente. Se <code>false</code>, apenas manual</li>
              <li><code>requiresApproval</code>: Se <code>true</code>, requer aprova√ß√£o manual antes de processar (ainda n√£o implementado)</li>
              <li><code>currency</code>: Moeda da configura√ß√£o - <code>"BRL"</code>, <code>"USD"</code>, etc.</li>
            </ul>
          </div>
        </div>

        <div class="flow-step">
          <h4>üîç Passo 3: Consultar Configura√ß√£o de Payout</h4>
          <p>
            Para ver a configura√ß√£o atual de payout de um territ√≥rio:
          </p>
          <pre class="code-block"><code># Consultar configura√ß√£o ativa
curl "http://localhost:8080/api/v1/territories/{territoryId}/payout-config" \
  -H "Authorization: Bearer &lt;token&gt;"</code></pre>
        </div>

        <div class="flow-step">
          <h4>üí∞ Passo 4: Consultar Saldo do Vendedor</h4>
          <p>
            Vendedores podem consultar seu saldo e hist√≥rico de transa√ß√µes:
          </p>
          <pre class="code-block"><code># Consultar meu saldo como vendedor
curl "http://localhost:8080/api/v1/territories/{territoryId}/seller-balance/me" \
  -H "Authorization: Bearer &lt;token&gt;"

# Consultar minhas transa√ß√µes como vendedor
curl "http://localhost:8080/api/v1/territories/{territoryId}/seller-balance/me/transactions" \
  -H "Authorization: Bearer &lt;token&gt;"</code></pre>
          <div style="margin-top: 1rem; padding: 1rem; background: #1a2a3a; border-radius: 0.5rem;">
            <strong>üìä Entendendo o Saldo do Vendedor:</strong>
            <ul style="margin-top: 0.5rem; line-height: 1.8;">
              <li><code>pendingAmountInCents</code>: Valor que ainda est√° no per√≠odo de reten√ß√£o</li>
              <li><code>readyForPayoutAmountInCents</code>: Valor pronto para payout (ap√≥s per√≠odo de reten√ß√£o e valor m√≠nimo)</li>
              <li><code>paidAmountInCents</code>: Valor j√° transferido para o vendedor</li>
            </ul>
          </div>
        </div>

        <div class="flow-step">
          <h4>üìà Passo 5: Gest√£o Financeira da Plataforma</h4>
          <p>
            Administradores podem consultar o saldo financeiro da plataforma (receitas de fees e despesas de payouts):
          </p>
          <pre class="code-block"><code># Consultar saldo da plataforma (apenas SystemAdmin ou FinancialManager)
curl "http://localhost:8080/api/v1/territories/{territoryId}/platform-financial/balance" \
  -H "Authorization: Bearer &lt;token&gt;"

# Listar receitas (fees coletadas)
curl "http://localhost:8080/api/v1/territories/{territoryId}/platform-financial/revenue" \
  -H "Authorization: Bearer &lt;token&gt;"

# Listar despesas (payouts processados)
curl "http://localhost:8080/api/v1/territories/{territoryId}/platform-financial/expenses" \
  -H "Authorization: Bearer &lt;token&gt;"</code></pre>
        </div>

        <div class="flow-step">
          <h4>üîß Passo 6: Configura√ß√£o em Produ√ß√£o - Checklist</h4>
          <p>
            Para colocar o sistema de payout em produ√ß√£o, siga este checklist:
          </p>
          <div style="margin-top: 1rem; padding: 1.5rem; background: #1a2a3a; border-radius: 0.5rem; border-left: 4px solid #7cd1ff;">
            <h5 style="margin-top: 0;">‚úÖ Pr√©-requisitos</h5>
            <ol style="margin-left: 1.5rem; line-height: 2;">
              <li><strong>Migration aplicada</strong>: Execute a migration <code>20260119000000_AddFinancialSystem.cs</code> no banco de dados</li>
              <li><strong>Gateway de pagamento configurado</strong>: Tenha uma conta no gateway (Stripe Connect, MercadoPago, etc.)</li>
              <li><strong>Background worker ativo</strong>: Certifique-se de que o <code>PayoutProcessingWorker</code> est√° rodando</li>
            </ol>

            <h5 style="margin-top: 1.5rem;">‚öôÔ∏è Configura√ß√£o Inicial</h5>
            <ol style="margin-left: 1.5rem; line-height: 2;">
              <li><strong>Configure payout por territ√≥rio</strong>: Use <code>POST /api/v1/territories/{territoryId}/payout-config</code></li>
              <li><strong>Configure per√≠odo de reten√ß√£o</strong>: Recomendado: 7-14 dias (protege contra chargebacks)</li>
              <li><strong>Configure valor m√≠nimo</strong>: Recomendado: R$ 50,00 - R$ 200,00 (reduz custos de transfer√™ncia)</li>
              <li><strong>Configure valor m√°ximo</strong>: Se necess√°rio, limite por payout (ex: R$ 50.000,00)</li>
              <li><strong>Escolha frequ√™ncia</strong>: <code>"Daily"</code> (di√°rio), <code>"Weekly"</code> (semanal) ou <code>"Monthly"</code> (mensal)</li>
              <li><strong>Habilite payout autom√°tico</strong>: Defina <code>autoPayoutEnabled: true</code></li>
            </ol>

            <h5 style="margin-top: 1.5rem;">üîå Integra√ß√£o com Gateway de Pagamento</h5>
            <ol style="margin-left: 1.5rem; line-height: 2;">
              <li><strong>Implemente IPayoutGateway</strong>: Crie implementa√ß√£o para seu gateway (Stripe, MercadoPago, etc.)</li>
              <li><strong>Registre no DI</strong>: Substitua <code>MockPayoutGateway</code> por sua implementa√ß√£o real em <code>ServiceCollectionExtensions.cs</code></li>
              <li><strong>Configure credenciais</strong>: Adicione chaves de API do gateway em <code>appsettings.json</code> ou vari√°veis de ambiente</li>
              <li><strong>Teste em sandbox</strong>: Use ambiente de testes do gateway antes de produ√ß√£o</li>
            </ol>

            <h5 style="margin-top: 1.5rem;">üß™ Testes e Valida√ß√£o</h5>
            <ol style="margin-left: 1.5rem; line-height: 2;">
              <li><strong>Teste checkout completo</strong>: Crie checkout, marque como <code>Paid</code> e verifique se <code>SellerTransaction</code> foi criada</li>
              <li><strong>Verifique reten√ß√£o</strong>: Confirme que o valor fica em <code>pendingAmountInCents</code> durante o per√≠odo de reten√ß√£o</li>
              <li><strong>Teste valor m√≠nimo</strong>: Crie m√∫ltiplos checkouts pequenos e confirme que s√≥ processa quando atinge o m√≠nimo</li>
              <li><strong>Verifique payout autom√°tico</strong>: Aguarde o background worker processar e verifique transfer√™ncia no gateway</li>
              <li><strong>Monitore logs</strong>: Verifique logs do <code>PayoutProcessingWorker</code> para erros ou avisos</li>
            </ol>
          </div>
        </div>

        <div class="flow-step">
          <h4>üèóÔ∏è Passo 7: Implementar Gateway de Pagamento Real</h4>
          <p>
            O sistema vem com um <code>MockPayoutGateway</code> para desenvolvimento. Para produ√ß√£o, voc√™ precisa
            implementar o <code>IPayoutGateway</code> para seu gateway de pagamento preferido (Stripe Connect, MercadoPago, etc.).
          </p>
          <div style="margin-top: 1rem; padding: 1rem; background: #1a2a3a; border-radius: 0.5rem;">
            <strong>üìù Exemplo: Interface IPayoutGateway</strong>
            <pre class="code-block" style="margin-top: 0.5rem; background: #0a0e12;"><code>public interface IPayoutGateway
{
  Task&lt;OperationResult&lt;PayoutResult&gt;&gt; CreatePayoutAsync(
    long amountInCents,
    string currency,
    string sellerAccountId,
    string description,
    Dictionary&lt;string, string&gt;? metadata,
    CancellationToken cancellationToken);
  
  Task&lt;OperationResult&lt;PayoutStatusResult&gt;&gt; GetPayoutStatusAsync(
    string payoutId,
    CancellationToken cancellationToken);
  
  Task&lt;OperationResult&gt; CancelPayoutAsync(
    string payoutId,
    CancellationToken cancellationToken);
}</code></pre>
            <p style="margin-top: 1rem;">
              Voc√™ precisa implementar os 3 m√©todos acima para seu gateway de pagamento. Veja o exemplo de
              <code>MockPayoutGateway</code> em <code>backend/Araponga.Infrastructure/Payments/MockPayoutGateway.cs</code>
              como refer√™ncia.
            </p>
          </div>
        </div>

        <div class="flow-step">
          <h4>üîÑ Passo 8: Como Funciona o Background Worker</h4>
          <p>
            O <code>PayoutProcessingWorker</code> verifica payouts pendentes a cada 5 minutos e processa automaticamente
            conforme a frequ√™ncia configurada:
          </p>
          <ul style="margin-left: 1.5rem; line-height: 1.8;">
            <li><strong>Daily</strong>: Processa payouts todos os dias (quando o worker roda)</li>
            <li><strong>Weekly</strong>: Processa payouts toda segunda-feira √†s 00:00 UTC</li>
            <li><strong>Monthly</strong>: Processa payouts no dia 1 de cada m√™s √†s 00:00 UTC</li>
            <li><strong>Manual</strong>: N√£o processa automaticamente - apenas quando chamado manualmente via API</li>
          </ul>
          <p style="margin-top: 1rem;">
            O worker est√° configurado automaticamente quando voc√™ roda a API. N√£o precisa fazer nada extra para ativ√°-lo.
          </p>
        </div>

        <div class="flow-step">
          <h4>üìä Passo 9: Monitoramento e Troubleshooting</h4>
          <p>
            Para monitorar o sistema de payout em produ√ß√£o:
          </p>
          <ul style="margin-left: 1.5rem; line-height: 1.8;">
            <li><strong>Logs do Worker</strong>: Procure por <code>PayoutProcessingWorker</code> nos logs para ver processamento</li>
            <li><strong>Transa√ß√µes Financeiras</strong>: Consulte <code>GET /api/v1/territories/{territoryId}/platform-financial/revenue</code> para receitas</li>
            <li><strong>Transa√ß√µes de Despesa</strong>: Consulte <code>GET /api/v1/territories/{territoryId}/platform-financial/expenses</code> para payouts</li>
            <li><strong>Status de Payouts</strong>: Use <code>UpdatePayoutStatusAsync</code> para atualizar status do gateway periodicamente</li>
          </ul>
        </div>

        <div class="grid-two" style="margin-top: 2rem;">
          <div class="card">
            <h3>üéØ Casos de Uso Comuns</h3>
            <ul style="line-height: 1.8;">
              <li><strong>Vendedor quer saber quando receber√°</strong>: Consulte <code>/seller-balance/me</code> para ver valores pendentes e prontos para payout</li>
              <li><strong>Processar payout manualmente</strong>: Use <code>ProcessPendingPayoutsAsync</code> do <code>SellerPayoutService</code> via API admin</li>
              <li><strong>Ver hist√≥rico de transa√ß√µes</strong>: Consulte <code>/seller-balance/me/transactions</code> para ver todas as transa√ß√µes do vendedor</li>
              <li><strong>Auditar receitas da plataforma</strong>: Use endpoints de <code>/platform-financial</code> para ver fees coletadas</li>
            </ul>
          </div>
          <div class="card">
            <h3>‚ö†Ô∏è Pontos de Aten√ß√£o</h3>
            <ul style="line-height: 1.8;">
              <li><strong>Per√≠odo de reten√ß√£o</strong>: Protege contra chargebacks - n√£o configure muito curto</li>
              <li><strong>Valor m√≠nimo</strong>: Reduz custos de transfer√™ncia - configure baseado no custo do gateway</li>
              <li><strong>Valor m√°ximo</strong>: Limita exposi√ß√£o a risco - configure se necess√°rio</li>
              <li><strong>Moedas diferentes</strong>: Cada territ√≥rio pode ter configura√ß√£o em moeda diferente</li>
              <li><strong>Testes primeiro</strong>: Sempre teste com valores pequenos antes de produ√ß√£o</li>
            </ul>
          </div>
        </div>

        <div class="callout" style="background: #1a3a2a; border-left: 4px solid #7cd1ff; padding: 1rem; margin: 2rem 0;">
          <strong>üìö Documenta√ß√£o T√©cnica Completa</strong>
          <p style="margin-top: 0.5rem;">
            Para detalhes t√©cnicos completos, consulte:
            <a href="https://github.com/sraphaz/araponga/blob/main/docs/backlog-api/FASE7.md" style="color: #7cd1ff;">docs/backlog-api/FASE7.md</a>
          </p>
        </div>
      </section>

      <section class="section" id="eventos">
        <span class="eyebrow" data-i18n="events.eyebrow">Eventos</span>
        <h2 data-i18n="events.title">Eventos territoriais com data/hora e localiza√ß√£o</h2>
        <p data-i18n="events.lead">
          Eventos s√£o criados por moradores e aparecem no feed e no mapa. Eles t√™m data/hora de in√≠cio
          (obrigat√≥ria) e fim (opcional), al√©m de geolocaliza√ß√£o obrigat√≥ria.
        </p>

        <div class="flow-step">
          <h4>17. Criar evento com imagem de capa e imagens adicionais</h4>
          <p>
            Use <code>POST /api/v1/events</code> para criar eventos. O evento automaticamente gera um post
            no feed e aparece no mapa. Eventos podem incluir uma imagem de capa (<code>coverMediaId</code>) e
            at√© 10 imagens adicionais (<code>additionalMediaIds</code>).
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/events \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "title": "Feira de artesanato",
    "description": "Feira mensal no centro",
    "startsAtUtc": "2024-12-15T10:00:00Z",
    "endsAtUtc": "2024-12-15T18:00:00Z",
    "latitude": -23.55,
    "longitude": -46.63,
    "locationLabel": "Pra√ßa Central",
    "coverMediaId": "ffffffff-ffff-ffff-ffff-ffffffffffff",
    "additionalMediaIds": ["aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"]
  }'</code></pre>
          <div style="margin-top: 1rem; padding: 1rem; background: #1a2a3a; border-radius: 0.5rem;">
            <strong>üì∏ M√≠dias em Eventos:</strong>
            <ul style="margin-top: 0.5rem; line-height: 1.8;">
              <li><strong>Upload de m√≠dia</strong>: Primeiro, fa√ßa upload via <code>POST /api/v1/media/upload</code> para obter o <code>mediaId</code></li>
              <li><strong>Imagem de capa</strong>: Use <code>coverMediaId</code> para definir a imagem principal do evento (opcional)</li>
              <li><strong>Imagens adicionais</strong>: Use <code>additionalMediaIds</code> para incluir at√© 10 imagens adicionais</li>
              <li><strong>Resposta</strong>: O <code>EventResponse</code> inclui <code>coverImageUrl</code> e <code>additionalImageUrls</code></li>
            </ul>
          </div>
        </div>

        <div class="flow-step">
          <h4>18. Interesse e confirma√ß√£o em eventos</h4>
          <p>
            Usu√°rios podem marcar interesse via <code>POST /api/v1/events/{eventId}/interest</code> e confirmar participa√ß√£o via
            <code>POST /api/v1/events/{eventId}/confirm</code>.
          </p>
          <pre class="code-block"><code># Marcar interesse
curl -X POST http://localhost:8080/api/v1/events/{eventId}/interest \
  -H "Authorization: Bearer &lt;token&gt;" \
  
# Confirmar participa√ß√£o
curl -X POST http://localhost:8080/api/v1/events/{eventId}/confirm \
  -H "Authorization: Bearer &lt;token&gt;"</code></pre>
        </div>
      </section>

      <section class="section" id="auth">
        <span class="eyebrow" data-i18n="auth.eyebrow">Autentica√ß√£o</span>
        <h2 data-i18n="auth.title">JWT (HS256)</h2>
        <p data-i18n-html="auth.leadHtml">
          O token √© emitido pelo endpoint <code>/api/v1/auth/social</code>. Ele utiliza algoritmo HS256 e
          valida <code>issuer</code> e <code>audience</code> conforme configura√ß√£o em <code>appsettings.json</code>.
        </p>
        <table class="kv-table">
          <thead>
            <tr>
              <th>Configura√ß√£o</th>
              <th>Chave</th>
              <th>Local</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Issuer</td>
              <td>Jwt:Issuer</td>
              <td>backend/Araponga.Api/appsettings.json</td>
            </tr>
            <tr>
              <td>Audience</td>
              <td>Jwt:Audience</td>
              <td>backend/Araponga.Api/appsettings.json</td>
            </tr>
            <tr>
              <td>SigningKey</td>
              <td>Jwt:SigningKey</td>
              <td>backend/Araponga.Api/appsettings.json</td>
            </tr>
          </tbody>
        </table>
        <div class="grid-two">
          <div class="card">
            <h3>Autentica√ß√£o de Dois Fatores (2FA)</h3>
            <p>
              A API suporta autentica√ß√£o de dois fatores usando TOTP (Time-based One-Time Password).
              Usu√°rios podem configurar 2FA via <code>POST /api/v1/auth/2fa/setup</code> e confirmar via
              <code>POST /api/v1/auth/2fa/confirm</code>. Recovery codes s√£o fornecidos durante a configura√ß√£o.
            </p>
            <ul>
              <li><strong>Setup</strong>: <code>POST /api/v1/auth/2fa/setup</code> - Gera secret e QR code</li>
              <li><strong>Confirm</strong>: <code>POST /api/v1/auth/2fa/confirm</code> - Habilita 2FA ap√≥s validar c√≥digo</li>
              <li><strong>Verify</strong>: <code>POST /api/v1/auth/2fa/verify</code> - Verifica c√≥digo TOTP e retorna JWT</li>
              <li><strong>Recover</strong>: <code>POST /api/v1/auth/2fa/recover</code> - Usa recovery code para autentica√ß√£o</li>
              <li><strong>Disable</strong>: <code>POST /api/v1/auth/2fa/disable</code> - Desabilita 2FA (requer c√≥digo v√°lido)</li>
            </ul>
          </div>
          <div class="card">
            <h3>Seguran√ßa</h3>
            <p>
              A API implementa v√°rias camadas de seguran√ßa para proteger dados e opera√ß√µes cr√≠ticas.
            </p>
            <ul>
              <li><strong>Sanitiza√ß√£o de Inputs</strong>: HTML, paths, URLs e SQL s√£o sanitizados</li>
              <li><strong>Prote√ß√£o CSRF</strong>: Anti-forgery tokens configurados</li>
              <li><strong>Security Headers</strong>: CSP, HSTS, X-Frame-Options e outros headers de seguran√ßa</li>
              <li><strong>Rate Limiting</strong>: Prote√ß√£o contra abuso e DDoS</li>
              <li><strong>Auditoria</strong>: Todas as a√ß√µes cr√≠ticas s√£o registradas</li>
            </ul>
          </div>
        </div>
        <div class="notice">
          <strong>Erro 401:</strong> token ausente, inv√°lido, expirado ou com issuer/audience incorretos.
          Em geral, autoriza√ß√µes negadas retornam <strong>401</strong>, mas a valida√ß√£o de membership sem
          morador validado retorna <strong>403</strong>.
        </div>
      </section>

      <section class="section" id="territory-session">
        <span class="eyebrow" data-i18n="headers.eyebrow">Contexto e headers</span>
        <h2 data-i18n="headers.title">Territ√≥rio, sess√£o e geolocaliza√ß√£o</h2>
        <p data-i18n-html="headers.leadHtml">
          V√°rias rotas aceitam o territ√≥rio via <code>territoryId</code> na query ou via sess√£o com
          <code>X-Session-Id</code>. Al√©m disso, algumas opera√ß√µes exigem presen√ßa geogr√°fica.
        </p>
        <table class="kv-table">
          <thead>
            <tr>
              <th>Header</th>
              <th>Uso</th>
              <th>Onde √© obrigat√≥rio</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>X-Session-Id</td>
              <td>Seleciona territ√≥rio ativo da sess√£o.</td>
              <td>Feed, Mapa, Alerts, Assets, Marketplace, Events, Modera√ß√£o quando <code>territoryId</code> n√£o est√° na query.</td>
            </tr>
            <tr>
              <td>X-Geo-Latitude / X-Geo-Longitude</td>
              <td>Comprova presen√ßa no territ√≥rio.</td>
              <td>Declara√ß√£o de membership conforme policy.</td>
            </tr>
          </tbody>
        </table>
        <div class="callout">
          <strong>PresencePolicy:</strong> a exig√™ncia de geolocaliza√ß√£o para membership √© configurada em
          <code>PresencePolicy:Policy</code>. O valor padr√£o atual √© <code>ResidentOnly</code>.
        </div>
      </section>

      <section class="section" id="admin">
        <span class="eyebrow" data-i18n="admin.eyebrow">Admin</span>
        <h2 data-i18n="admin.title">System Config, Work Queue e evid√™ncias</h2>
        <p data-i18n-html="admin.leadHtml">
          Para suportar valida√ß√µes e governan√ßa com rastreabilidade, a API implementa <strong>SystemConfig</strong>
          (configura√ß√µes calibr√°veis), <strong>WorkItem</strong> (fila gen√©rica de revis√£o humana) e
          <strong>DocumentEvidence</strong> (metadados de documentos com upload e download por proxy).
          Leia o documento completo em <a href="https://github.com/sraphaz/araponga/blob/main/docs/33_ADMIN_SYSTEM_CONFIG_WORKQUEUE.md" rel="noopener">docs/33_ADMIN_SYSTEM_CONFIG_WORKQUEUE.md</a>.
        </p>
        <div class="grid-two">
          <div class="card">
            <h3 data-i18n="admin.endpointsTitle">Endpoints principais</h3>
            <ul>
              <li><strong>System Config (SystemAdmin)</strong>: <code>GET /api/v1/admin/system-configs</code> e <code>GET/PUT /api/v1/admin/system-configs/{key}</code></li>
              <li><strong>Work Items (SystemAdmin)</strong>: <code>GET /api/v1/admin/work-items</code></li>
              <li><strong>Work Items (territorial)</strong>: <code>GET /api/v1/territories/{territoryId}/work-items</code></li>
              <li><strong>Upload identidade</strong>: <code>POST /api/v1/verification/identity/document/upload</code></li>
              <li><strong>Upload resid√™ncia</strong>: <code>POST /api/v1/memberships/{territoryId}/verify-residency/document/upload</code></li>
              <li><strong>Download por proxy</strong>: <code>GET /api/v1/admin/evidences/{evidenceId}/download</code></li>
            </ul>
          </div>
          <div class="card">
            <h3 data-i18n="admin.notesTitle">Notas</h3>
            <ul>
              <li data-i18n-html="admin.note1Html"><strong>Autoriza√ß√£o</strong>: SystemAdmin decide identidade; Curator decide resid√™ncia e curadoria; Curator/Moderator decide modera√ß√£o.</li>
              <li data-i18n-html="admin.note2Html"><strong>Proxy download</strong>: a API faz streaming do storage para aplicar autoriza√ß√£o e auditoria (sem URL p√∫blica).</li>
              <li data-i18n-html="admin.note3Html"><strong>OpenAPI</strong>: veja as rotas na se√ß√£o OpenAPI ‚Äî tags <code>Admin</code>, <code>Verification</code>, <code>Moderation</code>.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="openapi">
        <span class="eyebrow" data-i18n="openapi.eyebrow">OpenAPI</span>
        <h2 data-i18n="openapi.title">API Explorer (Swagger UI local)</h2>
        <div class="api-explorer">
          <p data-i18n-html="openapi.leadHtml">
            O explorer usa a especifica√ß√£o real da API. Ele tenta carregar o Swagger din√¢mico em
            <code>/swagger/v1/swagger.json</code> (quando o backend roda em <code>Development</code>) e usa
            fallback para <code>../openapi.json</code>. A navega√ß√£o √© feita por tags, endpoints e schemas.
          </p>
          <a class="button" href="./openapi.json" data-i18n="openapi.download">Baixar OpenAPI (JSON)</a>
          <button class="button secondary" type="button" data-explorer-button aria-expanded="false">
            <span data-i18n="openapi.open">Abrir Explorer</span>
          </button>
          <p data-explorer-status class="callout" data-i18n="openapi.statusReady">Explorer pronto para carregar.</p>
          <div id="openapi-browser" class="swagger-hidden" aria-live="polite"></div>
        </div>
      </section>

      <section class="section" id="erros">
        <span class="eyebrow" data-i18n="errors.eyebrow">Erros & conven√ß√µes</span>
        <h2 data-i18n="errors.title">Como interpretar respostas</h2>
        <div class="grid-two">
          <div class="card">
            <h3>Formato de erro</h3>
            <p>
              Erros de valida√ß√£o costumam retornar <code>{"error": "mensagem"}</code>. Exce√ß√µes n√£o tratadas
              retornam <code>ProblemDetails</code> com <code>title</code>, <code>status</code>, <code>detail</code>,
              <code>traceId</code> e <code>path</code>.
            </p>
          </div>
          <div class="card">
            <h3>C√≥digos comuns</h3>
            <ul>
              <li><strong>400</strong> dados inv√°lidos ou headers obrigat√≥rios ausentes.</li>
              <li><strong>401</strong> token ausente/ inv√°lido ou falta de permiss√£o.</li>
              <li><strong>404</strong> recurso inexistente (territory, post, user).</li>
              <li><strong>409</strong> n√£o usado atualmente.</li>
              <li><strong>500</strong> exce√ß√µes n√£o tratadas (ProblemDetails).</li>
            </ul>
          </div>
        </div>
        <div class="callout">
          <strong>Status da API:</strong> <code>GET /liveness</code> responde <code>{"status": "ok"}</code> e
          <code>GET /readiness</code> responde <code>{"status": "ready"}</code>. Logs seguem a configura√ß√£o
          padr√£o de <code>Logging</code> no <code>appsettings.json</code>.
        </div>
      </section>

      <section class="section" id="quickstart">
        <span class="eyebrow" data-i18n="quickstart.eyebrow">Quickstart</span>
        <h2 data-i18n="quickstart.title">Copie e cole (5‚Äì10 comandos)</h2>
        <div class="grid-two">
          <div class="card">
            <h3 data-i18n="quickstart.bashTitle">Bash (Linux/macOS/Git Bash)</h3>
            <pre class="code-block"><code># 1) Rodar API
ASPNETCORE_ENVIRONMENT=Development dotnet run --project backend/Araponga.Api --urls http://localhost:8080

# 2) Autentica√ß√£o social (gera token)
curl -X POST http://localhost:8080/api/v1/auth/social \
  -H "Content-Type: application/json" \
  -d '{"provider":"google","externalId":"abc-123","displayName":"Ana","cpf":"12345678900"}'

# 3) Descobrir territ√≥rio
curl http://localhost:8080/api/v1/territories

# 4) Selecionar territ√≥rio (X-Session-Id)
curl -X POST http://localhost:8080/api/v1/territories/selection \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{"territoryId":"11111111-1111-1111-1111-111111111111"}'</code></pre>
          </div>
          <div class="card">
            <h3 data-i18n="quickstart.powershellTitle">PowerShell (Windows)</h3>
            <pre class="code-block"><code># 1) Rodar API
$env:ASPNETCORE_ENVIRONMENT="Development"
dotnet run --project backend/Araponga.Api --urls "http://localhost:8080"

# 2) Autentica√ß√£o social (gera token)
curl.exe -X POST "http://localhost:8080/api/v1/auth/social" `
  -H "Content-Type: application/json" `
  -d "{\"provider\":\"google\",\"externalId\":\"abc-123\",\"displayName\":\"Ana\",\"cpf\":\"12345678900\"}"

# 3) Descobrir territ√≥rio
curl.exe "http://localhost:8080/api/v1/territories"

# 4) Selecionar territ√≥rio (X-Session-Id)
curl.exe -X POST "http://localhost:8080/api/v1/territories/selection" `
  -H "Content-Type: application/json" `
  -H "X-Session-Id: session-123" `
  -d "{\"territoryId\":\"11111111-1111-1111-1111-111111111111\"}"</code></pre>
          </div>
        </div>
        <div class="callout">
          <span data-i18n-html="quickstart.tipHtml"><strong>Dica:</strong> este portal tem fonte √∫nica em <code>backend/Araponga.Api/wwwroot/devportal</code> (HTML/CSS/JS/OpenAPI). O deploy do GitHub Pages publica exatamente essa pasta.</span>
        </div>
      </section>

      <section class="section" id="capacidades-tecnicas">
        <span class="eyebrow">Funda√ß√µes T√©cnicas</span>
        <h2>Qualidade, Performance e Observabilidade</h2>
        <p class="lead-text">
          A API Araponga foi constru√≠da sobre uma base s√≥lida de pr√°ticas de engenharia moderna.
          Arquitetura limpa, testes abrangentes e observabilidade completa garantem confiabilidade,
          manutenibilidade e escalabilidade para comunidades em produ√ß√£o.
        </p>

        <div class="model-grid" style="margin-top: 3rem;">
          <div class="card">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem;">
              <span style="font-size: 1.75rem;">‚úì</span>
              <h3 style="margin: 0;">Qualidade de C√≥digo</h3>
            </div>
            <p style="color: var(--text-muted); margin-bottom: 1.25rem; line-height: 1.6;">
              Engenharia de software orientada a qualidade e confiabilidade, com foco em
              manutenibilidade a longo prazo e evolu√ß√£o segura da plataforma.
            </p>
            <dl class="entity-list" style="margin-top: 1rem;">
              <dt><strong>Pagina√ß√£o padronizada</strong></dt>
              <dd>15 endpoints cr√≠ticos implementam pagina√ß√£o completa com <code>PaginatedResult&lt;T&gt;</code>, garantindo performance consistente em grandes volumes de dados.</dd>

              <dt><strong>Valida√ß√£o robusta</strong></dt>
              <dd>FluentValidation em todas as camadas: contratos de API, comandos de aplica√ß√£o e regras de dom√≠nio. Valida√ß√µes declarativas e mensagens de erro claras.</dd>

              <dt><strong>Cobertura de testes superior a 90%</strong></dt>
              <dd>Testes unit√°rios, de integra√ß√£o e end-to-end cobrindo fluxos cr√≠ticos. Testes de infraestrutura para reposit√≥rios e servi√ßos de aplica√ß√£o.</dd>

              <dt><strong>Testes de seguran√ßa e performance</strong></dt>
              <dd>Testes automatizados de vulnerabilidades comuns, valida√ß√£o de autoriza√ß√£o e testes de carga para endpoints cr√≠ticos.</dd>

              <dt><strong>Refatora√ß√£o completa de services</strong></dt>
              <dd>Arquitetura limpa com Single Responsibility Principle. Services focados, test√°veis e desacoplados, facilitando manuten√ß√£o e evolu√ß√£o.</dd>
            </dl>
          </div>

          <div class="card">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem;">
              <span style="font-size: 1.75rem;">‚ö°</span>
              <h3 style="margin: 0;">Performance & Escalabilidade</h3>
            </div>
            <p style="color: var(--text-muted); margin-bottom: 1.25rem; line-height: 1.6;">
              Otimiza√ß√µes arquiteturais e t√©cnicas avan√ßadas para garantir baixa lat√™ncia
              e capacidade de crescimento com o aumento da demanda.
            </p>
            <dl class="entity-list" style="margin-top: 1rem;">
              <dt><strong>Concorr√™ncia otimista</strong></dt>
              <dd>RowVersion em entidades cr√≠ticas previne condi√ß√µes de corrida e garante consist√™ncia de dados em opera√ß√µes concorrentes.</dd>

              <dt><strong>Cache distribu√≠do</strong></dt>
              <dd>Redis para cache de sess√µes, configura√ß√µes e dados frequentemente acessados, reduzindo carga no banco de dados.</dd>

              <dt><strong>Processamento ass√≠ncrono</strong></dt>
              <dd>Event Bus com padr√£o Outbox/Inbox para processamento confi√°vel de eventos, notifica√ß√µes e opera√ß√µes em background.</dd>

              <dt><strong>Read replicas</strong></dt>
              <dd>Suporte nativo para leitura distribu√≠da, permitindo escalar consultas independentemente de opera√ß√µes de escrita.</dd>

              <dt><strong>Deployment multi-inst√¢ncia</strong></dt>
              <dd>Arquitetura stateless permite escalonamento horizontal sem compartilhamento de estado entre inst√¢ncias.</dd>
            </dl>
          </div>

          <div class="card">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem;">
              <span style="font-size: 1.75rem;">üìä</span>
              <h3 style="margin: 0;">Observabilidade</h3>
            </div>
            <p style="color: var(--text-muted); margin-bottom: 1.25rem; line-height: 1.6;">
              Visibilidade completa sobre o comportamento da plataforma em produ√ß√£o,
              permitindo detec√ß√£o proativa de problemas e otimiza√ß√£o cont√≠nua.
            </p>
            <dl class="entity-list" style="margin-top: 1rem;">
              <dt><strong>Logs estruturados</strong></dt>
              <dd>Serilog com Seq para logs centralizados, pesquis√°veis e estruturados. Contexto enriquecido para debugging eficiente.</dd>

              <dt><strong>M√©tricas Prometheus</strong></dt>
              <dd>M√©tricas de neg√≥cio e infraestrutura expostas em formato Prometheus para monitoramento e alertas baseados em thresholds.</dd>

              <dt><strong>Distributed tracing</strong></dt>
              <dd>OpenTelemetry para rastreamento de requisi√ß√µes atrav√©s de servi√ßos, facilitando identifica√ß√£o de gargalos e depend√™ncias.</dd>

              <dt><strong>Dashboards e alertas</strong></dt>
              <dd>Grafana para visualiza√ß√£o de m√©tricas e alertas configur√°veis para eventos cr√≠ticos e degrada√ß√£o de performance.</dd>

              <dt><strong>Runbook e troubleshooting</strong></dt>
              <dd>Documenta√ß√£o operacional detalhada para incidentes comuns, facilitando resolu√ß√£o r√°pida e consistente de problemas.</dd>
            </dl>
          </div>

          <div class="card">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem;">
              <span style="font-size: 1.75rem;">üîí</span>
              <h3 style="margin: 0;">Seguran√ßa</h3>
            </div>
            <p style="color: var(--text-muted); margin-bottom: 1.25rem; line-height: 1.6;">
              M√∫ltiplas camadas de prote√ß√£o para garantir integridade de dados, privacidade
              dos usu√°rios e resist√™ncia a ataques comuns.
            </p>
            <dl class="entity-list" style="margin-top: 1rem;">
              <dt><strong>Autentica√ß√£o multi-fator</strong></dt>
              <dd>2FA via TOTP (Time-based One-Time Password) para prote√ß√£o adicional de contas sens√≠veis e opera√ß√µes cr√≠ticas.</dd>

              <dt><strong>Sanitiza√ß√£o avan√ßada</strong></dt>
              <dd>Valida√ß√£o e sanitiza√ß√£o rigorosa de inputs em todas as camadas, prevenindo inje√ß√£o de c√≥digo e XSS.</dd>

              <dt><strong>Prote√ß√£o CSRF</strong></dt>
              <dd>Anti-forgery tokens para prevenir requisi√ß√µes cross-site n√£o autorizadas em opera√ß√µes de estado.</dd>

              <dt><strong>Security headers</strong></dt>
              <dd>Content Security Policy (CSP), HTTP Strict Transport Security (HSTS) e outros headers de seguran√ßa configurados adequadamente.</dd>

              <dt><strong>Auditoria completa</strong></dt>
              <dd>Log de todas as a√ß√µes cr√≠ticas (mudan√ßas de role, modera√ß√£o, configura√ß√µes) para rastreabilidade e compliance.</dd>
            </dl>
          </div>
        </div>

        <div class="callout" style="margin-top: 3rem; background: var(--accent-subtle); border-left: 3px solid var(--accent);">
          <p style="margin: 0; color: var(--text);">
            <strong>Qualidade em produ√ß√£o:</strong> A API Araponga segue rigorosamente os princ√≠pios de engenharia de software
            de alto padr√£o, com foco em confiabilidade, manutenibilidade e escalabilidade. Todas as decis√µes arquiteturais
            foram documentadas e s√£o continuamente revisadas para garantir evolu√ß√£o segura e sustent√°vel da plataforma.
          </p>
        </div>
      </section>

      <section class="section" id="versoes">
        <span class="eyebrow" data-i18n="versions.eyebrow">Vers√µes & compatibilidade</span>
        <h2 data-i18n="versions.title">Versionamento</h2>
        <p data-i18n-html="versions.leadHtml">
          A API atual utiliza prefixo <code>/api/v1</code>. Mudan√ßas compat√≠veis devem manter o contrato dentro
          dessa vers√£o. Para evolu√ß√£o maior, a estrat√©gia recomendada √© introduzir um novo prefixo.
        </p>
        <div class="callout">
          Consulte o changelog do reposit√≥rio em <a href="https://github.com/sraphaz/araponga/blob/main/docs/40_CHANGELOG.md">docs/40_CHANGELOG.md</a> para hist√≥rico.
        </div>
      </section>

      <footer class="footer" role="contentinfo">
        <p>
          Portal dispon√≠vel em <a href="https://devportal.araponga.app" rel="noopener">https://devportal.araponga.app</a>.
          Para contribuir, consulte o reposit√≥rio e a documenta√ß√£o t√©cnica local.
        </p>
      </footer>
    </main>
  </div>

  <script src="./assets/js/devportal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    // Inicializa√ß√£o do Mermaid (ap√≥s Mermaid.js ser carregado)
    (function() {
      function initMermaid() {
        if (typeof mermaid === 'undefined') {
          console.error('Mermaid.js n√£o foi carregado corretamente.');
          setTimeout(initMermaid, 100);
          return;
        }

      mermaid.initialize({
      startOnLoad: false,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#141a21',
        primaryTextColor: '#e8edf2',
        primaryBorderColor: '#4dd4a8',
        lineColor: '#7dd3ff',
        secondaryColor: '#1a2129',
        tertiaryColor: '#0f1419',
        background: '#0a0e12',
        mainBkg: '#0a0e12',
        secondBkg: '#141a21',
        textColor: '#e8edf2',
        actorBorder: '#4dd4a8',
        actorBkg: '#141a21',
        actorTextColor: '#e8edf2',
        actorLineColor: '#4dd4a8',
        signalColor: '#7dd3ff',
        signalTextColor: '#e8edf2',
        labelBoxBkgColor: '#4dd4a8',
        labelBoxBorderColor: '#3bc495',
        labelTextColor: '#0a0e12',
        loopTextColor: '#e8edf2',
        noteBorderColor: '#4dd4a8',
        noteBkgColor: '#141a21',
        noteTextColor: '#e8edf2',
        activationBorderColor: '#4dd4a8',
        activationBkgColor: 'rgba(77, 212, 168, 0.2)',
        sequenceNumberColor: '#4dd4a8'
      },
      flowchart: {
        curve: 'basis',
        padding: 20,
        useMaxWidth: true
      },
      sequence: {
        diagramMarginX: 60,
        diagramMarginY: 20,
        actorMargin: 80,
        width: 180,
        height: 80,
        boxMargin: 15,
        boxTextMargin: 8,
        noteMargin: 15,
        messageMargin: 50,
        mirrorActors: true,
        bottomMarginAdj: 1,
        useMaxWidth: false,
        rightAngles: false,
        showSequenceNumbers: false
      },
      gantt: {
        titleTopMargin: 25,
        barHeight: 20,
        barGap: 4,
        topPadding: 50,
        leftPadding: 75,
        gridLineStartPadding: 35,
        fontSize: 11,
        fontFamily: '"Inter", sans-serif',
        numberSectionStyles: 4,
        axisFormat: '%Y-%m-%d'
      }
      });

      // Renderizar diagramas quando os acorde√µes s√£o expandidos
      function initDiagramRendering() {
        var diagramToggles = document.querySelectorAll('.sequence-diagram-toggle');
        
        diagramToggles.forEach(function(toggle) {
          var rendered = false;
          var diagramContainer = toggle.querySelector('.mermaid');
          var containerDiv = toggle.querySelector('.sequence-diagram-container');
          
          // Adicionar bot√£o de fullscreen
          if (diagramContainer && containerDiv) {
            var fullscreenBtn = document.createElement('button');
            fullscreenBtn.className = 'diagram-fullscreen-btn';
            fullscreenBtn.textContent = '‚õ∂ Tela Cheia';
            fullscreenBtn.setAttribute('aria-label', 'Abrir diagrama em tela cheia');
            containerDiv.appendChild(fullscreenBtn);
            
            fullscreenBtn.addEventListener('click', function(e) {
              e.stopPropagation();
              openDiagramFullscreen(diagramContainer);
            });
          }
          
          toggle.addEventListener('toggle', function(event) {
            if (this.open && !rendered) {
              if (diagramContainer) {
                var diagramId = diagramContainer.getAttribute('data-diagram') || 'diagram-' + Date.now();
                 // IMPORTANTE: Usar innerHTML em vez de textContent para evitar que o navegador
                 // adicione tags de fechamento autom√°ticas ao processar <Tipo> em tipos gen√©ricos C#
                 // O navegador pode interpretar <Territory> como tag HTML n√£o fechada e adicionar </territory>
                 var diagramContent = diagramContainer.innerHTML.trim();
                 
                 // Decodifica entidades HTML em ordem segura para evitar double unescaping
                 // IMPORTANTE: &amp; deve ser decodificado por √∫ltimo para evitar converter &amp;lt; em &lt;
                 var tempContent = diagramContent
                   .replace(/&quot;/g, '"')
                   .replace(/&#x27;/g, "'")
                   .replace(/&#39;/g, "'")
                   .replace(/&lt;/g, '<')
                   .replace(/&gt;/g, '>')
                   .replace(/&amp;/g, '&'); // Decodifica &amp; por √∫ltimo
                 
                 // Primeiro proteger tipos gen√©ricos C# (como List<Territory>, PagedResult<CommunityPost>)
                 // Padr√£o: Palavra<TipoComLetraMaiuscula> -> Palavra&lt;TipoComLetraMaiuscula&gt;
                 // Regex melhorado: captura palavra completa antes de < (sem espa√ßo)
                 var protectedContent = tempContent.replace(/([a-zA-Z][a-zA-Z0-9]*[a-zA-Z0-9]|[a-zA-Z])<([A-Z][a-zA-Z0-9]+)>/g, function(match, prefix, type) {
                   return prefix + '&lt;' + type + '&gt;';
                 });
                 
                 var cleanedDiagramContent = protectedContent
                   // Remove tags <script> com todas varia√ß√µes (espa√ßos, atributos, etc)
                   .replace(/<\/?\s*script\s*(?:\s+[^>]*)?\s*>/gi, '')
                   // Remove conte√∫do entre tags script (caso alguma tag tenha escapado)
                   .replace(/<script[\s\S]*?<\/\s*script\s*>/gi, '')
                   // Remove tags <style> com todas varia√ß√µes (espa√ßos, atributos, etc)
                   .replace(/<\/?\s*style\s*(?:\s+[^>]*)?\s*>/gi, '')
                   // Remove conte√∫do entre tags style (caso alguma tag tenha escapado)
                   .replace(/<style[\s\S]*?<\/\s*style\s*>/gi, '')
                   // Remove TODAS as tags de fechamento XML/HTML (</qualquercoisa>)
                   // IMPORTANTE: Executar m√∫ltiplas vezes para remover tags aninhadas e incompletas
                   // Remove tags completas: </territory>, </feeditemresponse>
                   .replace(/<\/[a-zA-Z][a-zA-Z0-9-]*\s*>/gi, '')
                   // Remove tags incompletas: </terri (sem fechamento >)
                   .replace(/<\/[a-zA-Z][a-zA-Z0-9-]*\s*$/gm, '')
                   // Segunda e terceira passagem para garantir remo√ß√£o completa
                   .replace(/<\/[a-zA-Z][a-zA-Z0-9-]*\s*>/gi, '')
                   .replace(/<\/[a-zA-Z][a-zA-Z0-9-]*\s*$/gm, '')
                   .replace(/<\/[a-zA-Z][a-zA-Z0-9-]*\s*>/gi, '')
                   .replace(/<\/[a-zA-Z][a-zA-Z0-9-]*\s*$/gm, '')
                   // Remove tags de abertura XML/HTML (tags come√ßam com min√∫scula)
                   // Preserva tipos gen√©ricos protegidos como &lt;Territory&gt;
                   .replace(/<([a-z][a-zA-Z0-9-]+)(?:\s+[^>]*)?\s*>/gi, '')
                   // Restaurar tipos gen√©ricos: &lt;Tipo&gt; -> <Tipo>
                   .replace(/&lt;/g, '<')
                   .replace(/&gt;/g, '>')
                   .trim();
                 
                 if (cleanedDiagramContent && !diagramContainer.hasAttribute('data-processed')) {
                   // Guardar o texto original limpo antes de renderizar
                   diagramContainer.setAttribute('data-original-code', cleanedDiagramContent);
                  
                  try {
                    mermaid.run({
                      nodes: [diagramContainer],
                      suppressErrors: false
                    }).then(function() {
                      rendered = true;
                      diagramContainer.setAttribute('data-processed', 'true');
                      
                      // Adicionar bot√£o de fullscreen AP√ìS renderizar
                      if (diagramContainer && containerDiv) {
                        // Remover bot√£o existente se houver
                        var existingBtn = containerDiv.querySelector('.diagram-fullscreen-btn');
                        if (existingBtn) {
                          existingBtn.remove();
                        }
                        
                        var fullscreenBtn = document.createElement('button');
                        fullscreenBtn.className = 'diagram-fullscreen-btn';
                        fullscreenBtn.textContent = '‚õ∂ Tela Cheia';
                        fullscreenBtn.setAttribute('aria-label', 'Abrir diagrama em tela cheia');
                        containerDiv.appendChild(fullscreenBtn);
                        
                        fullscreenBtn.addEventListener('click', function(e) {
                          e.stopPropagation();
                          openDiagramFullscreen(diagramContainer);
                        });
                      }
                    }).catch(function(err) {
                      console.error('Erro ao renderizar diagrama:', err);
                      var errorMsg = document.createElement('div');
                      errorMsg.className = 'callout';
                      errorMsg.style.color = 'var(--danger)';
                      errorMsg.textContent = 'Erro ao renderizar diagrama: ' + (err.message || 'Erro desconhecido');
                      containerDiv.appendChild(errorMsg);
                    });
                  } catch (err) {
                    console.error('Erro ao inicializar renderiza√ß√£o:', err);
                  }
                }
              }
            }
          });
        });
      }
      
      // Fun√ß√£o para abrir diagrama em tela cheia
      function openDiagramFullscreen(diagramElement) {
        // SEMPRE buscar primeiro do data-original-code (c√≥digo original antes de renderizar)
        var diagramText = diagramElement.getAttribute('data-original-code');
        
        // Se n√£o encontrou no data-attribute, tentar buscar do elemento original
        if (!diagramText || diagramText.trim() === '') {
          // Se o elemento ainda n√£o foi renderizado, pegar o textContent
          if (!diagramElement.hasAttribute('data-processed')) {
            diagramText = diagramElement.textContent || diagramElement.innerText || '';
            // Limpar HTML se houver
            if (diagramText) {
              diagramText = diagramText.replace(/<[^>]*>/g, '').trim();
            }
          } else {
            // J√° foi renderizado mas n√£o tem data-original-code - procurar no container
            var parentContainer = diagramElement.closest('.sequence-diagram-container');
            if (parentContainer) {
              var originalCode = parentContainer.querySelector('.mermaid[data-diagram]');
              if (originalCode && originalCode.getAttribute('data-original-code')) {
                diagramText = originalCode.getAttribute('data-original-code');
              } else {
                console.error('Diagrama j√° foi renderizado mas n√£o tem data-original-code');
                alert('Erro: N√£o foi poss√≠vel encontrar o c√≥digo original do diagrama. Recarregue a p√°gina.');
                return;
              }
            } else {
              console.error('N√£o foi poss√≠vel encontrar o container do diagrama');
              alert('Erro: N√£o foi poss√≠vel encontrar o c√≥digo original do diagrama.');
              return;
            }
          }
        }
        
        // Validar que temos c√≥digo v√°lido Mermaid
        if (!diagramText || !diagramText.trim().startsWith('sequenceDiagram')) {
          console.error('C√≥digo Mermaid inv√°lido:', diagramText);
          alert('Erro: C√≥digo do diagrama n√£o est√° no formato correto. Recarregue a p√°gina.');
          return;
        }
        
        // Criar modal se n√£o existir
        var modal = document.getElementById('diagram-modal');
        if (!modal) {
          modal = document.createElement('div');
          modal.id = 'diagram-modal';
          modal.className = 'diagram-modal';
          
          var modalContent = document.createElement('div');
          modalContent.className = 'diagram-modal-content';
          
          var closeBtn = document.createElement('button');
          closeBtn.className = 'diagram-modal-close';
          closeBtn.textContent = '√ó';
          closeBtn.setAttribute('aria-label', 'Fechar');
          closeBtn.addEventListener('click', function() {
            modal.classList.remove('active');
            document.body.style.overflow = '';
          });
          
          var mermaidClone = document.createElement('div');
          mermaidClone.className = 'mermaid';
          
          modalContent.appendChild(mermaidClone);
          modal.appendChild(closeBtn);
          modal.appendChild(modalContent);
          document.body.appendChild(modal);
          
          // Fechar com ESC
          modal.addEventListener('click', function(e) {
            if (e.target === modal) {
              modal.classList.remove('active');
              document.body.style.overflow = '';
            }
          });
          
          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
              modal.classList.remove('active');
              document.body.style.overflow = '';
            }
          });
        }
        
        // Obter o elemento mermaid do modal e limpar conte√∫do anterior
        var modalMermaid = modal.querySelector('.mermaid');
        if (modalMermaid) {
          // Limpar conte√∫do anterior (SVG renderizado)
          modalMermaid.innerHTML = '';
          modalMermaid.textContent = diagramText.trim();
          modalMermaid.removeAttribute('data-processed');
          modalMermaid.removeAttribute('id');
          
          // Renderizar no modal
          try {
            mermaid.run({
              nodes: [modalMermaid],
              suppressErrors: false
            }).then(function() {
              modal.classList.add('active');
              document.body.style.overflow = 'hidden';
            }).catch(function(err) {
              console.error('Erro ao renderizar diagrama no modal:', err);
              modal.classList.remove('active');
              document.body.style.overflow = '';
              alert('Erro ao renderizar diagrama: ' + (err.message || 'Erro desconhecido'));
            });
          } catch (err) {
            console.error('Erro ao inicializar renderiza√ß√£o no modal:', err);
            modal.classList.remove('active');
            document.body.style.overflow = '';
            alert('Erro ao abrir diagrama: ' + (err.message || 'Erro desconhecido'));
          }
        }
      }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initDiagramRendering);
        } else {
          initDiagramRendering();
        }
      }

      // Aguardar carregamento do Mermaid antes de inicializar
      if (typeof mermaid !== 'undefined') {
        initMermaid();
      } else {
        // Tentar novamente ap√≥s um delay se Mermaid ainda n√£o foi carregado
        var checkMermaid = setInterval(function() {
          if (typeof mermaid !== 'undefined') {
            clearInterval(checkMermaid);
            initMermaid();
          }
        }, 100);
        
        // Timeout de seguran√ßa ap√≥s 5 segundos
        setTimeout(function() {
          clearInterval(checkMermaid);
          if (typeof mermaid === 'undefined') {
            console.error('Mermaid.js n√£o foi carregado ap√≥s 5 segundos.');
          }
        }, 5000);
      }
    })();
  </script>
</body>
</html>

