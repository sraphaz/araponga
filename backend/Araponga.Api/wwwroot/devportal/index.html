<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Developer Portal da API Araponga: território, memberships, feed, mapa, marketplace, eventos, chat, moderação e notificações." />
  <meta name="theme-color" content="#0a0e12" />
  <title>Araponga API • Developer Portal</title>
  <link rel="icon" href="./assets/images/araponga-icon.svg" />
  <link rel="apple-touch-icon" href="./assets/images/araponga-icon.svg" />
  <link rel="stylesheet" href="./assets/css/devportal.css" />
</head>
<body>
  <a class="skip-link" href="#conteudo" data-i18n="ui.skip">Pular para conteúdo</a>

  <header class="header" role="banner">
    <div class="container hero">
      <div class="return-banner" role="complementary">
        <span data-i18n="ui.portalTitle">Developer Portal da API Araponga</span>
        <div class="lang-switcher" aria-label="Selecionar idioma">
          <label class="lang-label" for="lang-select" data-i18n="ui.lang">Idioma</label>
          <select id="lang-select" class="lang-select">
            <option value="pt">Português</option>
            <option value="es">Español</option>
            <option value="en">English</option>
            <option value="it">Italiano</option>
            <option value="hi">हिन्दी</option>
          </select>
        </div>
        <a href="https://araponga.app" rel="noopener" aria-label="Voltar para o site principal do Araponga" data-i18n="ui.backHome">← Voltar para araponga.app</a>
      </div>

      <span class="hero-tag" aria-label="Categoria" data-i18n="ui.heroTag">Araponga API • Developer Portal</span>
      <h1 data-i18n="ui.heroTitle">Infraestrutura territorial para comunidades locais.</h1>
      <p data-i18n-html="ui.heroLeadHtml">
        O Araponga é uma plataforma comunitária <strong>territory-first</strong>. O território organiza contexto,
        visibilidade e governança. Este portal documenta o produto e a API exatamente como implementada hoje,
        para acelerar o onboarding de desenvolvedores com segurança e previsibilidade.
      </p>

      <nav class="hero-actions" aria-label="Ações rápidas">
        <a class="button" href="#quickstart" aria-label="Ir para o guia de início rápido" data-i18n="ui.quickstart">Quickstart</a>
        <a class="button secondary" href="#openapi" aria-label="Ver documentação OpenAPI" data-i18n="ui.openapi">OpenAPI</a>
        <a class="button secondary" href="#auth" aria-label="Ver documentação de autenticação" data-i18n="ui.auth">Autenticação</a>
        <a class="button secondary" href="#territory-session" aria-label="Ver como selecionar território" data-i18n="ui.selectTerritory">Selecionar território</a>
      </nav>
    </div>
  </header>

  <div class="container layout" id="conteudo">
    <nav class="nav" aria-label="Navegação do portal" role="navigation">
      <h2 data-i18n="nav.title">Conteúdo</h2>
      <ul role="list">
        <li><a href="#visao-geral" data-i18n="nav.overview">Visão geral</a></li>
        <li><a href="#como-funciona" data-i18n="nav.howItWorks">Como o Araponga funciona</a></li>
        <li><a href="#territorios" data-i18n="nav.territories">Territórios</a></li>
        <li><a href="#conceitos" data-i18n="nav.productConcepts">Conceitos de produto</a></li>
        <li><a href="#modelo-dominio" data-i18n="nav.domainModel">Modelo de domínio</a></li>
        <li><a href="#fluxos" data-i18n="nav.flows">Fluxos principais</a></li>
        <li><a href="#casos-de-uso" data-i18n="nav.useCases">Casos de uso</a></li>
        <li><a href="#marketplace" data-i18n="nav.marketplace">Marketplace</a></li>
        <li><a href="#eventos" data-i18n="nav.events">Eventos</a></li>
        <li><a href="#auth" data-i18n="nav.jwt">Autenticação (JWT)</a></li>
        <li><a href="#territory-session" data-i18n="nav.headers">Território & headers</a></li>
        <li><a href="#admin" data-i18n="nav.admin">Admin & filas</a></li>
        <li><a href="#openapi" data-i18n="nav.openapi">OpenAPI / Explorer</a></li>
        <li><a href="#erros" data-i18n="nav.errors">Erros & convenções</a></li>
        <li><a href="#quickstart" data-i18n="nav.quickstart">Quickstart</a></li>
        <li><a href="#versoes" data-i18n="nav.versions">Versões</a></li>
      </ul>
    </nav>

    <main role="main">
      <section class="section" id="visao-geral">
        <span class="eyebrow" data-i18n="overview.eyebrow">Visão geral</span>
        <h2 data-i18n="overview.title">API orientada a território + curadoria comunitária.</h2>
        <p data-i18n="overview.lead">
          A API da Araponga cria um núcleo confiável para território, vínculos, feed, mapa, marketplace e eventos. Ela prioriza
          regras explícitas (visibilidade, validação e moderação) para que experiências locais sejam
          auditáveis e evoluam com segurança.
        </p>
        <div class="grid-two">
          <div class="card">
            <h3>Por que território?</h3>
            <p>
              Território é o recorte geográfico base. Ele separa o "onde" do "quem" e do "o quê".
              Isso evita que conteúdo social distorça o mapa e mantém o contexto local como primeira-class.
            </p>
          </div>
          <div class="card">
            <h3>Governança em camadas</h3>
            <p>
              Vínculos (visitor/resident), validações comunitárias, moderação (reports/bloqueios) e
              notificações in-app
              formam as camadas que definem o que aparece no feed e no mapa.
            </p>
          </div>
        </div>
      </section>

      <section class="section" id="como-funciona">
        <span class="eyebrow" data-i18n="how.eyebrow">Como o Araponga funciona</span>
        <h2 data-i18n="how.title">Do visitante ao morador validado</h2>
        <div class="grid-two">
          <div class="card">
            <h3>Visitante</h3>
            <p>
              Visitantes declaram vínculo com <code>role=Visitor</code>. Não existe "validação" para visitante:
              é apenas um vínculo leve para acesso a conteúdo público e operações permitidas para não-moradores.
            </p>
          </div>
          <div class="card">
            <h3>Pedido de moradia</h3>
            <p>
              Para virar morador, o visitante cria um pedido (JoinRequest) via
              <code>POST /api/v1/memberships/{territoryId}/become-resident</code>.
              Se ele conhecer alguém, pode enviar <code>recipientUserIds</code> e fazer um convite direcionado.
              Sem destinatários, o pedido vai para a curadoria (Curator) e, se necessário, para SystemAdmin.
            </p>
          </div>
          <div class="card">
            <h3>Aprovação comunitária</h3>
            <p>
              Destinatários (ou curadores) aprovam/rejeitam via
              <code>POST /api/v1/join-requests/{id}/approve|reject</code>. Ao aprovar, o requester
              torna-se <strong>RESIDENT</strong> (ainda <strong>NÃO verificado</strong>).
              A verificação de residência acontece depois via
              <code>POST /api/v1/memberships/{territoryId}/verify-residency/geo</code> ou
              <code>/verify-residency/document</code>.
            </p>
          </div>
          <div class="card">
            <h3>Bootstrap (primeiro morador)</h3>
            <p>
              Não existe "fundador" autoaprovado. Se o território ainda não tiver curadores/moradores verificados,
              o pedido faz fallback para <strong>SystemAdmin</strong> (governança global) para destravar o bootstrap.
            </p>
          </div>
        </div>
      </section>

      <section class="section" id="territorios">
        <span class="eyebrow" data-i18n="territories.eyebrow">Territórios</span>
        <h2 data-i18n="territories.title">Unidade primária com vínculo estrutural</h2>
        <div class="grid-two">
          <div class="card">
            <h3>Estado atual</h3>
            <p>
              Territórios continuam sendo a unidade primária de organização. Todo conteúdo e
              governança são ancorados diretamente no território selecionado.
            </p>
          </div>
          <div class="card">
            <h3>ParentTerritoryId</h3>
            <p>
              O campo <code>ParentTerritoryId</code> existe apenas para modelar hierarquia estrutural
              (ex.: bairro → município). Ele ainda não gera herança de permissões, feeds ou validações.
            </p>
          </div>
          <div class="card">
            <h3>Roadmap (não implementado)</h3>
            <p>
              Herança de permissões, feeds agregados e regras automáticas por hierarquia permanecem
              como roadmap e <strong>não</strong> fazem parte do backend atual.
            </p>
          </div>
        </div>
      </section>

      <section class="section" id="conceitos">
        <span class="eyebrow" data-i18n="concepts.eyebrow">Conceitos de produto</span>
        <h2 data-i18n="concepts.title">Semântica de negócio</h2>
        <div class="grid-two">
          <div class="card">
            <h3>Territory-first</h3>
            <p>
              Território é uma célula geográfica neutra. Não carrega conteúdo social embutido; ele apenas
              organiza contexto, priorização e governança.
            </p>
          </div>
          <div class="card">
            <h3>Memberships</h3>
            <p>
              Vínculos entre usuário e território podem ser <strong>VISITOR</strong> ou <strong>RESIDENT</strong>.
              O pedido de moradia (JoinRequest) tem status <strong>PENDING</strong>/<strong>APPROVED</strong>/<strong>REJECTED</strong>.
              Já a verificação de residência do membership é feita por flags: <strong>NONE</strong>/<strong>GEOVERIFIED</strong>/<strong>DOCUMENTVERIFIED</strong>,
              influenciando visibilidade e autorização.
            </p>
          </div>
          <div class="card">
            <h3>Feature flags por território</h3>
            <p>
              Cada território pode habilitar flags como <strong>AlertPosts</strong>
              em <code>/api/v1/territories/{territoryId}/features</code>. Elas controlam quais tipos de post são aceitos.
            </p>
          </div>
          <div class="card">
            <h3>Curadoria/Validação</h3>
            <p>
              A aprovação de pedidos de moradia é feita por <strong>Curators</strong> e/ou por moradores já
              verificados (geo/doc). Curadores também continuam responsáveis por validação de entidades do mapa
              e alertas ambientais.
            </p>
          </div>
          <div class="card">
            <h3>Moderação & segurança</h3>
            <p>
              Moderação é um conjunto de sinais (reports) + ações (bloqueios) para manter o território útil e
              seguro. O objetivo aqui não é "censura automática", e sim <strong>reduzir abuso e ruído</strong>
              com decisões auditáveis e fluxo claro de triagem por curadoria.
            </p>
            <ul>
              <li><strong>Reportar post</strong>: <code>POST /api/v1/reports/posts/{postId}</code> com <code>reason</code> (obrigatório) e <code>details</code> (opcional).</li>
              <li><strong>Reportar usuário</strong>: <code>POST /api/v1/reports/users/{userId}</code> (pode receber <code>territoryId</code>).</li>
              <li><strong>Triagem</strong>: curadoria lista e filtra em <code>GET /api/v1/reports</code> (por território, status e tipo).</li>
              <li><strong>Bloquear/desbloquear</strong>: corta visibilidade de conteúdo no feed e no mapa via <code>POST</code>/<code>DELETE /api/v1/blocks/users/{userId}</code>.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="modelo-dominio">
        <span class="eyebrow" data-i18n="domain.eyebrow">Modelo de domínio</span>
        <h2 data-i18n="domain.title">Entidades principais e relacionamentos</h2>
        <div class="callout">
          <strong data-i18n="domain.diagramPlaceholder">Diagrama do domínio: removido temporariamente (vou refazer a imagem).</strong>
        </div>

        <div class="model-grid">
          <div class="card">
            <h3>👤 Identidade e Membros</h3>
            <dl class="entity-list">
              <dt><strong>User</strong></dt>
              <dd>Cria identidade autenticada e recebe role (Visitor/Resident/Curator)</dd>
              
              <dt><strong>TerritoryMembership</strong></dt>
              <dd>Conecta <code>User ↔ Territory</code> e define role/status de validação</dd>
            </dl>
          </div>

          <div class="card">
            <h3>📝 Feed e Conteúdo</h3>
            <dl class="entity-list">
              <dt><strong>CommunityPost</strong></dt>
              <dd>Pertence ao Territory e pode referenciar MapEntity</dd>
              
              <dt><strong>PostGeoAnchor</strong></dt>
              <dd>Ancora posts no mapa com coordenadas geográficas</dd>
              
              <dt><strong>Feature Flags</strong></dt>
              <dd>Habilitam tipos de post por território (ex: AlertPosts)</dd>
            </dl>
          </div>

          <div class="card">
            <h3>🗺️ Mapa e Localização</h3>
            <dl class="entity-list">
              <dt><strong>MapEntity</strong></dt>
              <dd>Pertence ao Territory, começa como sugerida e pode ser validada por curadores</dd>
              
              <dt><strong>TerritoryAsset</strong></dt>
              <dd>Recursos territoriais com geolocalização obrigatória (rios, nascentes, etc.)</dd>
            </dl>
          </div>

          <div class="card">
            <h3>🛒 Marketplace</h3>
            <dl class="entity-list">
              <dt><strong>TerritoryStore</strong></dt>
              <dd>Representa loja de um morador no território</dd>
              
              <dt><strong>StoreListing</strong></dt>
              <dd>Produto ou serviço oferecido por uma loja</dd>
              
              <dt><strong>Cart</strong> / <strong>CartItem</strong></dt>
              <dd>Gerenciam carrinho de compras por território</dd>
              
              <dt><strong>ListingInquiry</strong></dt>
              <dd>Representa interesse de um usuário em um listing</dd>
            </dl>
          </div>

          <div class="card">
            <h3>📅 Eventos</h3>
            <dl class="entity-list">
              <dt><strong>TerritoryEvent</strong></dt>
              <dd>Eventos territoriais com data/hora de início (obrigatória) e fim (opcional), além de geolocalização obrigatória. Aparecem no feed e no mapa automaticamente</dd>
              
              <dt><strong>EventParticipation</strong></dt>
              <dd>Usuários declaram participação com status: <code>Going</code>, <code>Interested</code> ou <code>NotGoing</code></dd>
              
              <dt><strong>Integração Feed-Mapa</strong></dt>
              <dd>Criação de evento gera automaticamente um post no feed e um pin no mapa. Exemplo: "Feira de artesanato" na Praça Central aparece em ambos</dd>
            </dl>
            <div class="example-box">
              <strong>Exemplo prático:</strong> Morador cria evento "Mutirão de limpeza" para sábado 9h na Praça. O evento aparece no feed como post e no mapa como pin, permitindo que outros moradores vejam e declarem participação.
            </div>
          </div>

          <div class="card">
            <h3>🛡️ Moderação e Segurança</h3>
            <dl class="entity-list">
              <dt><strong>Reports</strong></dt>
              <dd>Denúncias registram sinais de abuso/spam para triagem. Ex.: <code>POST /api/v1/reports/posts/{postId}</code> e <code>POST /api/v1/reports/users/{userId}</code> com <code>reason</code> e <code>details</code>.</dd>

              <dt><strong>Curadoria (triagem)</strong></dt>
              <dd>Curadores podem listar e filtrar reports por <code>territoryId</code>, <code>status</code> e <code>targetType</code> em <code>GET /api/v1/reports</code>, criando um backlog prático de ação.</dd>
              
              <dt><strong>Blocks</strong></dt>
              <dd>Bloqueios removem do feed e do mapa o conteúdo produzido por um usuário bloqueado. Use <code>POST /api/v1/blocks/users/{userId}</code> e remova com <code>DELETE /api/v1/blocks/users/{userId}</code>.</dd>

              <dt><strong>Segurança de acesso</strong></dt>
              <dd>Operações dependem de JWT (<code>401</code> quando ausente/ inválido). Em conjunto com membership (visitor/resident) e presença (geo headers), isso evita ações sensíveis fora do contexto do território.</dd>
            </dl>
            <div class="example-box">
              <strong>Exemplo prático:</strong> após denúncias recorrentes, a curadoria filtra <code>GET /api/v1/reports?territoryId=...&amp;status=Open</code>, revisa os alvos e recomenda bloqueio do autor. O bloqueio reduz exposição de posts e entidades do mapa criadas por ele no território.
            </div>
          </div>

          <div class="card">
            <h3>🔔 Notificações</h3>
            <dl class="entity-list">
              <dt><strong>OutboxMessage</strong></dt>
              <dd>Garante a intenção de notificar em transações confiáveis</dd>
              
              <dt><strong>UserNotification</strong></dt>
              <dd>Compõe o inbox in-app por usuário</dd>
            </dl>
          </div>

          <div class="card card-full">
            <h3>💡 Por que essa estrutura existe</h3>
            <ul class="rationale-list">
              <li><strong>Separação de responsabilidades:</strong> Território separado de identidade evita acoplamento social no mapa</li>
              <li><strong>Governança clara:</strong> Vínculos explicitam presença local e governança comunitária</li>
              <li><strong>Integração feed-mapa:</strong> Posts + geo anchors conectam feed e mapa sem confundir o domínio</li>
              <li><strong>Economia local:</strong> Marketplace permite economia dentro do território</li>
              <li><strong>Engajamento:</strong> Eventos conectam comunidade com atividades locais</li>
              <li><strong>Confiança:</strong> Moderação mantém confiança com regras auditáveis</li>
              <li><strong>Confiabilidade:</strong> Notificações usam outbox para evitar perda de eventos após commit</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="fluxos">
        <span class="eyebrow" data-i18n="flows.eyebrow">Fluxos principais</span>
        <h2 data-i18n="flows.title">Sequências orientadas a produto e API</h2>

        <div class="flow-step">
          <h4>1. Autenticação social → JWT</h4>
          <p>
            Use <code>POST /api/v1/auth/social</code> com <code>Provider</code>, <code>ExternalId</code>, <code>DisplayName</code>
            e <strong>CPF</strong> ou <strong>ForeignDocument</strong>. A resposta traz o token JWT.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "google",
    "externalId": "abc-123",
    "displayName": "Ana Souza",
    "cpf": "12345678900",
    "email": "ana@exemplo.com"
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>2. Descoberta de território</h4>
          <p>
            <code>GET /api/v1/territories</code> lista territórios disponíveis. Para busca, use
            <code>/search</code> ou <code>/nearby</code> com <code>lat</code> e <code>lng</code>.
          </p>
          <pre class="code-block"><code>curl "http://localhost:8080/api/v1/territories/nearby?lat=-23.55&amp;lng=-46.63&amp;radiusKm=10"</code></pre>
        </div>

        <div class="flow-step" id="territory-selection">
          <h4>3. Seleção de território (sessão)</h4>
          <p>
            Defina o território ativo com <code>POST /api/v1/territories/selection</code> usando
            <code>X-Session-Id</code>. Esse header substitui o <code>territoryId</code> em várias rotas.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/territories/selection \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{"territoryId": "11111111-1111-1111-1111-111111111111"}'</code></pre>
        </div>

        <div class="flow-step">
          <h4>4. Feed territorial</h4>
          <p>
            <code>GET /api/v1/feed</code> retorna posts filtrados pelo território ativo. Visitantes veem
            apenas posts públicos publicados. Moradores veem conteúdo ampliado.
          </p>
          <pre class="code-block"><code>curl http://localhost:8080/api/v1/feed \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "X-Session-Id: session-123"</code></pre>
        </div>

        <div class="flow-step">
          <h4>5. Criar post + âncoras geográficas</h4>
          <p>
            Para criar post use <code>POST /api/v1/feed</code>. As âncoras geográficas são opcionais e
            posts são criados por moradores. Eventos são criados via <code>POST /api/v1/events</code>,
            com data/hora e geolocalização obrigatória, e aparecem no feed e no mapa.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/feed \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{
    "title": "Mutirão de limpeza",
    "content": "Encontro sábado 9h.",
    "type": "General",
    "visibility": "Public",
    "mapEntityId": null,
    "geoAnchors": [{"latitude": -23.55, "longitude": -46.63, "type": "POST"}],
    "assetIds": ["aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"]
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>6. Assets territoriais (com geolocalização obrigatória)</h4>
          <p>
            Assets sempre possuem ao menos uma âncora geográfica e são exibidos no mapa via pins do tipo
            <code>asset</code>. Somente moradores validados ou curadores podem criar/editar/arquivar.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/assets \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "type": "river",
    "name": "Rio do Vale",
    "description": "Trecho monitorado",
    "geoAnchors": [{"latitude": -23.55, "longitude": -46.63}]
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>7. Alertas ambientais (feed + mapa)</h4>
          <p>
            Alertas usam <code>/api/v1/alerts</code> e aparecem no feed e no mapa (pins do tipo
            <code>alert</code>) quando validados por curadores.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/alerts \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{"title": "Queimada", "description": "Fumaça próxima à nascente"}'</code></pre>
        </div>

        <div class="flow-step">
          <h4>8. Mapa: entidades, pins e validação</h4>
          <p>
            Use <code>GET /api/v1/map/entities</code> e <code>/pins</code> para visualizar. Sugestões usam
            <code>POST /api/v1/map/entities</code> (categorias: estabelecimento, órgão do governo, espaço público,
            espaço natural). Confirmações usam <code>/confirmations</code> e validações <code>/validation</code>
            são exclusivas para curadores. Pins aceitam filtros por <code>types</code>, <code>assetId</code> e
            <code>assetTypes</code>.
          </p>
          <pre class="code-block"><code>curl http://localhost:8080/api/v1/map/pins?types=asset,alert,entity \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "X-Session-Id: session-123"</code></pre>
        </div>

        <div class="flow-step">
          <h4>9. Membership: visitor → resident</h4>
          <p>
            O visitante solicita residência via
            <code>POST /api/v1/memberships/{territoryId}/become-resident</code> (convite direcionado via <code>recipientUserIds</code> ou fila de curadoria).
            Destinatários (ou curadores) aprovam em
            <code>POST /api/v1/join-requests/{id}/approve</code>, promovendo para
            <strong>RESIDENT</strong> (com <strong>ResidencyVerification=NONE</strong>).
            O status atual do vínculo está em <code>GET /api/v1/memberships/{territoryId}/me</code>.
            Para verificar residência (geo/doc), use <code>/verify-residency/geo</code> ou <code>/verify-residency/document</code>.
            Quando a policy exige presença, envie <code>X-Geo-Latitude</code>/<code>X-Geo-Longitude</code>.
          </p>
        </div>

        <div class="flow-step">
          <h4>10. Moderação & segurança: reports, triagem e bloqueios</h4>
          <p>
            O fluxo típico é: (1) um usuário reporta; (2) a curadoria lista reports do território e prioriza;
            (3) quando necessário, aplica bloqueio para cortar propagação do conteúdo no feed e no mapa.
            Reports usam <code>reason</code> (obrigatório) e <code>details</code> (opcional).
          </p>
          <pre class="code-block"><code># Reportar um post
curl -X POST http://localhost:8080/api/v1/reports/posts/&lt;postId&gt; \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{"reason":"Spam","details":"Link suspeito no conteúdo"}'

# Reportar um usuário (opcionalmente por território)
curl -X POST "http://localhost:8080/api/v1/reports/users/&lt;userId&gt;?territoryId=11111111-1111-1111-1111-111111111111" \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{"reason":"Abuso","details":"Comportamento inadequado"}'

# Curadoria lista reports para triagem
curl "http://localhost:8080/api/v1/reports?territoryId=11111111-1111-1111-1111-111111111111&amp;status=Open" \
  -H "Authorization: Bearer &lt;token&gt;"

# Bloquear / desbloquear um usuário
curl -X POST http://localhost:8080/api/v1/blocks/users/&lt;userId&gt; \
  -H "Authorization: Bearer &lt;token&gt;"

curl -X DELETE http://localhost:8080/api/v1/blocks/users/&lt;userId&gt; \
  -H "Authorization: Bearer &lt;token&gt;"</code></pre>
        </div>

        <div class="flow-step">
          <h4>11. Notificações in-app</h4>
          <p>
            Eventos relevantes geram mensagens em outbox que são processadas em background para criar
            notificações por usuário. Consulte <code>GET /api/v1/notifications</code> e marque como lidas em
            <code>POST /api/v1/notifications/{id}/read</code>.
          </p>
        </div>
      </section>

      <section class="section" id="casos-de-uso">
        <span class="eyebrow" data-i18n="usecases.eyebrow">Casos de uso</span>
        <h2 data-i18n="usecases.title">Como usar a API (cenários práticos)</h2>
        <p data-i18n-html="usecases.leadHtml">
          Estes cenários conectam objetivo → pré-requisitos → endpoints. Em geral, você vai precisar de um JWT
          e de um território selecionado via <code>X-Session-Id</code>.
        </p>
        <div class="grid-two">
          <div class="card">
            <h3>Onboarding (primeiro acesso)</h3>
            <ul>
              <li><strong>Autenticar</strong>: <code>POST /api/v1/auth/social</code></li>
              <li><strong>Descobrir território</strong>: <code>GET /api/v1/territories</code> (ou <code>/nearby</code>)</li>
              <li><strong>Selecionar território</strong>: <code>POST /api/v1/territories/selection</code> + <code>X-Session-Id</code></li>
              <li><strong>Checar membership</strong>: <code>GET /api/v1/memberships/{territoryId}/me</code></li>
            </ul>
          </div>
          <div class="card">
            <h3>Publicar conteúdo (feed + mapa)</h3>
            <ul>
              <li><strong>Ler feed</strong>: <code>GET /api/v1/feed</code></li>
              <li><strong>Criar post</strong>: <code>POST /api/v1/feed</code> (com <code>geoAnchors</code> opcionais)</li>
              <li><strong>Ver pins</strong>: <code>GET /api/v1/map/pins</code> (tipos: entity/asset/alert/post)</li>
            </ul>
          </div>
          <div class="card">
            <h3>Operações territoriais (assets/alerts)</h3>
            <ul>
              <li><strong>Criar asset</strong>: <code>POST /api/v1/assets</code> (geo obrigatória)</li>
              <li><strong>Criar alerta</strong>: <code>POST /api/v1/alerts</code> (validação por curadoria)</li>
              <li><strong>Listar pins</strong>: <code>GET /api/v1/map/pins?types=asset,alert</code></li>
            </ul>
          </div>
          <div class="card">
            <h3>Economia local e eventos</h3>
            <ul>
              <li><strong>Loja</strong>: <code>POST /api/v1/stores</code></li>
              <li><strong>Listings</strong>: <code>POST /api/v1/listings</code> e <code>GET /api/v1/listings/search</code></li>
              <li><strong>Carrinho</strong>: <code>POST /api/v1/cart/items</code> e <code>POST /api/v1/cart/checkout</code></li>
              <li><strong>Evento</strong>: <code>POST /api/v1/events</code> e <code>POST /api/v1/events/{id}/participation</code></li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="marketplace">
        <span class="eyebrow" data-i18n="marketplace.eyebrow">Marketplace</span>
        <h2 data-i18n="marketplace.title">Economia local territorial</h2>
        <p data-i18n="marketplace.lead">
          O marketplace permite que moradores criem lojas, listem produtos/serviços, gerenciem carrinho de compras
          e recebam inquiries de interessados. Tudo ancorado no território.
        </p>

        <div class="flow-step">
          <h4>12. Criar ou atualizar loja</h4>
          <p>
            Moradores validados podem criar ou atualizar sua loja no território via
            <code>POST /api/v1/stores</code>. A loja define informações de contato e visibilidade.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/stores \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "displayName": "Loja da Ana",
    "description": "Produtos artesanais",
    "contactVisibility": "Public",
    "contact": {
      "phone": "+5511999999999",
      "email": "ana@exemplo.com"
    }
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>13. Criar listing (produto ou serviço)</h4>
          <p>
            Lojas podem criar listings via <code>POST /api/v1/listings</code>. Listings podem ser produtos
            ou serviços, com preço fixo, negociável ou gratuito.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/listings \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "storeId": "22222222-2222-2222-2222-222222222222",
    "type": "Product",
    "title": "Bolo de chocolate",
    "description": "Bolo caseiro",
    "pricingType": "Fixed",
    "priceAmount": 25.00,
    "currency": "BRL"
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>14. Buscar listings</h4>
          <p>
            Use <code>GET /api/v1/listings/search</code> para buscar listings por território, categoria,
            tags ou texto livre.
          </p>
          <pre class="code-block"><code>curl "http://localhost:8080/api/v1/listings/search?territoryId=11111111-1111-1111-1111-111111111111&amp;search=bolo" \
  -H "Authorization: Bearer &lt;token&gt;"</code></pre>
        </div>

        <div class="flow-step">
          <h4>15. Gerenciar carrinho</h4>
          <p>
            Usuários podem adicionar itens ao carrinho via <code>POST /api/v1/cart/items</code>,
            atualizar quantidade via <code>PATCH /api/v1/cart/items/{id}</code> e fazer checkout via
            <code>POST /api/v1/cart/checkout</code>. O checkout gera inquiries para listings não compráveis
            e checkout items para os compráveis.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/cart/items \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "listingId": "33333333-3333-3333-3333-333333333333",
    "quantity": 2
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>16. Criar inquiry</h4>
          <p>
            Interessados podem criar inquiries diretamente em listings via
            <code>POST /api/v1/listings/{id}/inquiries</code>. A resposta inclui informações de contato
            da loja conforme visibilidade configurada.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/listings/33333333-3333-3333-3333-333333333333/inquiries \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{"message": "Gostaria de mais informações"}'</code></pre>
        </div>
      </section>

      <section class="section" id="eventos">
        <span class="eyebrow" data-i18n="events.eyebrow">Eventos</span>
        <h2 data-i18n="events.title">Eventos territoriais com data/hora e localização</h2>
        <p data-i18n="events.lead">
          Eventos são criados por moradores e aparecem no feed e no mapa. Eles têm data/hora de início
          (obrigatória) e fim (opcional), além de geolocalização obrigatória.
        </p>

        <div class="flow-step">
          <h4>17. Criar evento</h4>
          <p>
            Use <code>POST /api/v1/events</code> para criar eventos. O evento automaticamente gera um post
            no feed e aparece no mapa.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/events \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{
    "territoryId": "11111111-1111-1111-1111-111111111111",
    "title": "Feira de artesanato",
    "description": "Feira mensal no centro",
    "startsAtUtc": "2024-12-15T10:00:00Z",
    "endsAtUtc": "2024-12-15T18:00:00Z",
    "latitude": -23.55,
    "longitude": -46.63,
    "locationLabel": "Praça Central"
  }'</code></pre>
        </div>

        <div class="flow-step">
          <h4>18. Participação em eventos</h4>
          <p>
            Usuários podem declarar participação via <code>POST /api/v1/events/{id}/participation</code>
            com status <code>Going</code>, <code>Interested</code> ou <code>NotGoing</code>.
          </p>
          <pre class="code-block"><code>curl -X POST http://localhost:8080/api/v1/events/44444444-4444-4444-4444-444444444444/participation \
  -H "Authorization: Bearer &lt;token&gt;" \
  -H "Content-Type: application/json" \
  -d '{"status": "Going"}'</code></pre>
        </div>
      </section>

      <section class="section" id="auth">
        <span class="eyebrow" data-i18n="auth.eyebrow">Autenticação</span>
        <h2 data-i18n="auth.title">JWT (HS256)</h2>
        <p data-i18n-html="auth.leadHtml">
          O token é emitido pelo endpoint <code>/api/v1/auth/social</code>. Ele utiliza algoritmo HS256 e
          valida <code>issuer</code> e <code>audience</code> conforme configuração em <code>appsettings.json</code>.
        </p>
        <table class="kv-table">
          <thead>
            <tr>
              <th>Configuração</th>
              <th>Chave</th>
              <th>Local</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Issuer</td>
              <td>Jwt:Issuer</td>
              <td>backend/Araponga.Api/appsettings.json</td>
            </tr>
            <tr>
              <td>Audience</td>
              <td>Jwt:Audience</td>
              <td>backend/Araponga.Api/appsettings.json</td>
            </tr>
            <tr>
              <td>SigningKey</td>
              <td>Jwt:SigningKey</td>
              <td>backend/Araponga.Api/appsettings.json</td>
            </tr>
          </tbody>
        </table>
        <div class="notice">
          <strong>Erro 401:</strong> token ausente, inválido, expirado ou com issuer/audience incorretos.
          Em geral, autorizações negadas retornam <strong>401</strong>, mas a validação de membership sem
          morador validado retorna <strong>403</strong>.
        </div>
      </section>

      <section class="section" id="territory-session">
        <span class="eyebrow" data-i18n="headers.eyebrow">Contexto e headers</span>
        <h2 data-i18n="headers.title">Território, sessão e geolocalização</h2>
        <p data-i18n-html="headers.leadHtml">
          Várias rotas aceitam o território via <code>territoryId</code> na query ou via sessão com
          <code>X-Session-Id</code>. Além disso, algumas operações exigem presença geográfica.
        </p>
        <table class="kv-table">
          <thead>
            <tr>
              <th>Header</th>
              <th>Uso</th>
              <th>Onde é obrigatório</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>X-Session-Id</td>
              <td>Seleciona território ativo da sessão.</td>
              <td>Feed, Mapa, Alerts, Assets, Marketplace, Events, Moderação quando <code>territoryId</code> não está na query.</td>
            </tr>
            <tr>
              <td>X-Geo-Latitude / X-Geo-Longitude</td>
              <td>Comprova presença no território.</td>
              <td>Declaração de membership conforme policy.</td>
            </tr>
          </tbody>
        </table>
        <div class="callout">
          <strong>PresencePolicy:</strong> a exigência de geolocalização para membership é configurada em
          <code>PresencePolicy:Policy</code>. O valor padrão atual é <code>ResidentOnly</code>.
        </div>
      </section>

      <section class="section" id="admin">
        <span class="eyebrow" data-i18n="admin.eyebrow">Admin</span>
        <h2 data-i18n="admin.title">System Config, Work Queue e evidências</h2>
        <p data-i18n-html="admin.leadHtml">
          Para suportar validações e governança com rastreabilidade, a API implementa <strong>SystemConfig</strong>
          (configurações calibráveis), <strong>WorkItem</strong> (fila genérica de revisão humana) e
          <strong>DocumentEvidence</strong> (metadados de documentos com upload e download por proxy).
          Leia o documento completo em <a href="https://github.com/sraphaz/araponga/blob/main/docs/33_ADMIN_SYSTEM_CONFIG_WORKQUEUE.md" rel="noopener">docs/33_ADMIN_SYSTEM_CONFIG_WORKQUEUE.md</a>.
        </p>
        <div class="grid-two">
          <div class="card">
            <h3 data-i18n="admin.endpointsTitle">Endpoints principais</h3>
            <ul>
              <li><strong>System Config (SystemAdmin)</strong>: <code>GET/PUT /api/v1/admin/system-config</code></li>
              <li><strong>Work Items (SystemAdmin)</strong>: <code>GET /api/v1/admin/work-items</code></li>
              <li><strong>Work Items (territorial)</strong>: <code>GET /api/v1/territories/{territoryId}/work-items</code></li>
              <li><strong>Upload identidade</strong>: <code>POST /api/v1/verification/identity/document/upload</code></li>
              <li><strong>Upload residência</strong>: <code>POST /api/v1/memberships/{territoryId}/verify-residency/document/upload</code></li>
              <li><strong>Download por proxy</strong>: <code>GET /api/v1/admin/evidences/{evidenceId}/download</code></li>
            </ul>
          </div>
          <div class="card">
            <h3 data-i18n="admin.notesTitle">Notas</h3>
            <ul>
              <li data-i18n-html="admin.note1Html"><strong>Autorização</strong>: SystemAdmin decide identidade; Curator decide residência e curadoria; Curator/Moderator decide moderação.</li>
              <li data-i18n-html="admin.note2Html"><strong>Proxy download</strong>: a API faz streaming do storage para aplicar autorização e auditoria (sem URL pública).</li>
              <li data-i18n-html="admin.note3Html"><strong>OpenAPI</strong>: veja as rotas na seção OpenAPI — tags <code>Admin</code>, <code>Verification</code>, <code>Moderation</code>.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="section" id="openapi">
        <span class="eyebrow" data-i18n="openapi.eyebrow">OpenAPI</span>
        <h2 data-i18n="openapi.title">API Explorer (Swagger UI local)</h2>
        <div class="api-explorer">
          <p data-i18n-html="openapi.leadHtml">
            O explorer usa a especificação real da API. Ele tenta carregar o Swagger dinâmico em
            <code>/swagger/v1/swagger.json</code> (quando o backend roda em <code>Development</code>) e usa
            fallback para <code>../openapi.json</code>. A navegação é feita por tags, endpoints e schemas.
          </p>
          <a class="button" href="./openapi.json" data-i18n="openapi.download">Baixar OpenAPI (JSON)</a>
          <button class="button secondary" type="button" data-explorer-button aria-expanded="false">
            <span data-i18n="openapi.open">Abrir Explorer</span>
          </button>
          <p data-explorer-status class="callout" data-i18n="openapi.statusReady">Explorer pronto para carregar.</p>
          <div id="openapi-browser" class="swagger-hidden" aria-live="polite"></div>
        </div>
      </section>

      <section class="section" id="erros">
        <span class="eyebrow" data-i18n="errors.eyebrow">Erros & convenções</span>
        <h2 data-i18n="errors.title">Como interpretar respostas</h2>
        <div class="grid-two">
          <div class="card">
            <h3>Formato de erro</h3>
            <p>
              Erros de validação costumam retornar <code>{"error": "mensagem"}</code>. Exceções não tratadas
              retornam <code>ProblemDetails</code> com <code>title</code>, <code>status</code>, <code>detail</code>,
              <code>traceId</code> e <code>path</code>.
            </p>
          </div>
          <div class="card">
            <h3>Códigos comuns</h3>
            <ul>
              <li><strong>400</strong> dados inválidos ou headers obrigatórios ausentes.</li>
              <li><strong>401</strong> token ausente/ inválido ou falta de permissão.</li>
              <li><strong>404</strong> recurso inexistente (territory, post, user).</li>
              <li><strong>409</strong> não usado atualmente.</li>
              <li><strong>500</strong> exceções não tratadas (ProblemDetails).</li>
            </ul>
          </div>
        </div>
        <div class="callout">
          <strong>Status da API:</strong> <code>GET /liveness</code> responde <code>{"status": "ok"}</code> e
          <code>GET /readiness</code> responde <code>{"status": "ready"}</code>. Logs seguem a configuração
          padrão de <code>Logging</code> no <code>appsettings.json</code>.
        </div>
      </section>

      <section class="section" id="quickstart">
        <span class="eyebrow" data-i18n="quickstart.eyebrow">Quickstart</span>
        <h2 data-i18n="quickstart.title">Copie e cole (5–10 comandos)</h2>
        <div class="grid-two">
          <div class="card">
            <h3 data-i18n="quickstart.bashTitle">Bash (Linux/macOS/Git Bash)</h3>
            <pre class="code-block"><code># 1) Rodar API
ASPNETCORE_ENVIRONMENT=Development dotnet run --project backend/Araponga.Api --urls http://localhost:8080

# 2) Autenticação social (gera token)
curl -X POST http://localhost:8080/api/v1/auth/social \
  -H "Content-Type: application/json" \
  -d '{"provider":"google","externalId":"abc-123","displayName":"Ana","cpf":"12345678900"}'

# 3) Descobrir território
curl http://localhost:8080/api/v1/territories

# 4) Selecionar território (X-Session-Id)
curl -X POST http://localhost:8080/api/v1/territories/selection \
  -H "Content-Type: application/json" \
  -H "X-Session-Id: session-123" \
  -d '{"territoryId":"11111111-1111-1111-1111-111111111111"}'</code></pre>
          </div>
          <div class="card">
            <h3 data-i18n="quickstart.powershellTitle">PowerShell (Windows)</h3>
            <pre class="code-block"><code># 1) Rodar API
$env:ASPNETCORE_ENVIRONMENT="Development"
dotnet run --project backend/Araponga.Api --urls "http://localhost:8080"

# 2) Autenticação social (gera token)
curl.exe -X POST "http://localhost:8080/api/v1/auth/social" `
  -H "Content-Type: application/json" `
  -d "{\"provider\":\"google\",\"externalId\":\"abc-123\",\"displayName\":\"Ana\",\"cpf\":\"12345678900\"}"

# 3) Descobrir território
curl.exe "http://localhost:8080/api/v1/territories"

# 4) Selecionar território (X-Session-Id)
curl.exe -X POST "http://localhost:8080/api/v1/territories/selection" `
  -H "Content-Type: application/json" `
  -H "X-Session-Id: session-123" `
  -d "{\"territoryId\":\"11111111-1111-1111-1111-111111111111\"}"</code></pre>
          </div>
        </div>
        <div class="callout">
          <span data-i18n-html="quickstart.tipHtml"><strong>Dica:</strong> para manter o portal em <code>docs/</code> e no <code>wwwroot</code> sincronizados, execute
          <code>./docs/devportal/sync-devportal.ps1</code>.</span>
        </div>
      </section>

      <section class="section" id="versoes">
        <span class="eyebrow" data-i18n="versions.eyebrow">Versões & compatibilidade</span>
        <h2 data-i18n="versions.title">Versionamento</h2>
        <p data-i18n-html="versions.leadHtml">
          A API atual utiliza prefixo <code>/api/v1</code>. Mudanças compatíveis devem manter o contrato dentro
          dessa versão. Para evolução maior, a estratégia recomendada é introduzir um novo prefixo.
        </p>
        <div class="callout">
          Consulte o changelog do repositório em <a href="https://github.com/sraphaz/araponga/blob/main/docs/40_CHANGELOG.md">docs/40_CHANGELOG.md</a> para histórico.
        </div>
      </section>

      <footer class="footer" role="contentinfo">
        <p>
          Portal disponível em <a href="https://devportal.araponga.app" rel="noopener">https://devportal.araponga.app</a>.
          Para contribuir, consulte o repositório e a documentação técnica local.
        </p>
      </footer>
    </main>
  </div>

  <script src="./assets/js/devportal.js"></script>
</body>
</html>

